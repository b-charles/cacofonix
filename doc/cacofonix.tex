\documentclass{article}

% PACKAGES
\usepackage{color}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{xspace}
\usepackage{dingbat}
\usepackage{graphics}
\usepackage[inline]{asymptote}
\usepackage{subfig}
\usepackage{forarray}
\usepackage{ifthen}
\usepackage{calc}
\usepackage{longtable}
\usepackage{pifont}

% ASYMPTOTE & SUBFIG
\makeatletter
\newsavebox{\sfe@box}
\newenvironment{subfloatenv}[1]{%
\def\sfe@caption{#1}%
\setbox\sfe@box\hbox\bgroup\color@setgroup}%
{\color@endgroup\egroup\subfloat[\sfe@caption]%
{\usebox{\sfe@box}}}
\makeatother

% COMMANDS
\newcommand{\cacofonix}{\textsc{Cacofonix}\xspace}
\newcommand{\matlab}{\textsc{Matlab}\xspace}

\newcommand{\note}{\lstinline!Note!\xspace}

\newcommand{\frerejaques}{\emph{Fr\`ere Jacques}\xspace}

\newcommand{\file}[1]{\texttt{#1}\xspace}
\newcommand{\noteFile}{\file{Note.m}}
\newcommand{\cacofonixFile}{\file{cacofonix.m}}
\newcommand{\noteInitFile}{\file{NoteInit.m}}
\newcommand{\noteInitFrFile}{\file{NoteInit\_fr.m}}
\newcommand{\midi}{\file{.midi}}

\newcommand{\wikipedia}{\textsc{Wikipedia}\xspace}
\newcommand{\wiktionary}{\textsc{Wiktionary}\xspace}
\newcommand{\google}{\textsc{Google}\xspace}

\newcommand{\ie}{\emph{i.e.}\xspace}
\newcommand{\eg}{\emph{e.g.}\xspace}

\newcommand{\footurl}[1]{\footnote{\url{#1}}\xspace}
\newcommand{\exchange}[2]{\texttt{#1}\footnote{\url{#2}}\xspace}

\newcommand\sfz{s$\!f\!$z\xspace}

% instruments
\newcommand{\instrusection}[1]{ \\[5pt] \multicolumn{4}{l}{\textbf{#1}}\\}
\newcommand\lvlo{}
\newcommand\lvlt{\ding{105}}

% ALGORITHM
\newcounter{algonum}
\newcounter{algostep}[algonum]
\newcommand{\listofsteps}{}
\newcommand{\titlealgo}{}
\newlength{\algosteplen}
\newlength{\lentemp}

% add a step
\makeatletter

%%% FORMAT STEP NAME
\newcommand{\formatstepname}[2]{\textbf{#1#2.}}

%%% STEP
% #1 (optional): label
% #2           : name
% #3           : description
\newcommand{\step}[3][]{%
% increment the steps
\stepcounter{algostep}%
% add the counter at the list of steps
\ifthenelse{\thealgostep=1}{\edef\listofsteps{\thealgostep}}{\edef\listofsteps{\listofsteps,\thealgostep}}%
% check if the new name is longer than previous
\settowidth{\lentemp}{\formatstepname{\titlealgo}{\thealgostep}}%
\ifthenelse{\lengthtest{\lentemp>\algosteplen}}{\setlength{\algosteplen}{\lentemp}}{}%
% add the label in the aux file
\ifthenelse{\equal{#1}{}}{}{\protected@write\@auxout{}{\string\newlabel{Algo \titlealgo.Step #1}{{\titlealgo\thealgostep}{\thepage}{}{}{}}}}%
% record title and text
\expandafter\def\csname title@\thealgostep \endcsname {#2}%
\expandafter\def\csname text@\thealgostep \endcsname {#3}%
}
\makeatother

% ref to a step
\newcommand{\stepref}[2][]{\ifthenelse{\equal{#1}{}}{\ref{Algo \titlealgo.Step #2}}{\ref{Algo #1.Step #2}}}

%%% ALGO
% #1: name (one char)
% #2: short description
% #3: long description
\newenvironment{algo}[3]{%
\stepcounter{algonum}%
\def\titlealgo{#1}%
\setlength{\algosteplen}{0pt}%
\par \noindent \textbf{Algorithm #1} (\emph{#2}) #3%
}{%
\setlength{\parskip}{1ex}%
\ForEachX{,}{\par \noindent \makebox[\algosteplen][r]{\formatstepname{\titlealgo}{\the\thislevelcount}} \parbox[t]{\textwidth-\algosteplen}{[\csname title@\the\thislevelcount\endcsname] \csname text@\the\thislevelcount\endcsname\ifthenelse{\the\thislevelcount=\thealgostep}{\hspace{3mm}\rule[-0.5mm]{1mm}{3mm}}}{}}{\listofsteps}
}

% ME AND MYSELF
\definecolor{mecolor}{rgb}{1,0.25,0.25}
\definecolor{myselfcolor}{rgb}{0.25,0.25,1}
\newenvironment{meenv}{ \par \noindent \makebox[6em][r]{ \textcolor{mecolor}{Me}: `` --~}}{~''}
\newenvironment{myselfenv}{ \par \noindent \makebox[6em][r]{ \textcolor{myselfcolor}{Myself}: `` --~}}{~''}
\newcommand{\me}[1]{\begin{meenv}#1\end{meenv}}
\newcommand{\myself}[1]{\begin{myselfenv}#1\end{myselfenv}}

% MATLAB CODE
\definecolor{matlabcolor}{rgb}{0,0.5,0.5}
\lstset{ basicstyle=\color{matlabcolor}\ttfamily, literate={~}{$\sim$}1 {>>}{$\gg$}1, tabsize=4, numbers=left, numberstyle=\tiny\color{black}, stepnumber=3, numbersep=5pt, numberfirstline=false, firstnumber=1 }

% ASYMPTOTE
\begin{asydef}
import graph;

// pitch transitions
real tstart = 1; real tend = 6;
real t0 = 2; real p0 = 1;
real t1 = 5; real p1 = 5;

real pitchTransNone( real t ) { return p0; }
real pitchTransLinear( real t ) { return (p1-p0)*(t-t0)/(t1-t0) + p0; }
real pitchTransQuad( real t ) { return (p1-p0)*((t-t0)^2)/((t1-t0)^2) + p0; }
real pitchTransQuad2( real t ) { return (p0-p1)*((t-t1)^2)/((t0-t1)^2) + p1; }

void displayPitchTransition( real transi(real) ){
	size(5cm,3cm,false);
	draw( graph( transi, t0, t1 )--(t1,p1) );
	draw( (tstart,p0)--(t0,p0)^^(t1,p1)--(tend,p1), gray+dashed );
	xaxis( "time" );
	yaxis( "pitch" );
}

\end{asydef}

\title{\cacofonix user's guide}
\author{by B}
\date{}

\begin{document}

\maketitle

\me{Hi!}
\myself{Hello!}

\paragraph{}

\emph{Welcome. I and my inner voices will try to explain the features of \cacofonix. I realize my English is far to be perfect and I will be grateful of any suggestion to improve this document.}

\tableofcontents

\section{Foreword}

\cacofonix is a \matlab program, helping to write midi files.

\me{Who are the target customers? Who needs help to write midi files? Who thinks about \matlab to create a midi file? Who wakes up the morning and says ``Hoho! Today, I'm going to create a midi file. I think the easiest way is use \matlab and an underground library.''?}
\myself{Well, a lot of softwares for editing music and creating midi files exist, free or not, and are more attractive, intuitive, flexible and for better results. Nevertheless, \cacofonix was inspired from \exchange{Theme from Super Mario Brother Song}{http://www.mathworks.com/matlabcentral/fileexchange/8442}, a little project found on the \textsc{Matlab Central}, and the first midi files I produced was some themes from Zelda. So, I guess \cacofonix was created for \matlab geeks\dots}
\me{That's cool. One day, they'll rule the world.}

\paragraph{}

To read this document, you need know some music theory and \matlab bases: at least, read a music sheet and, \matlab side, know what is a script, a function, an array, maybe an object\dots Advanced users know what to do with \lstinline!addpath!, but the easiest way to use \cacofonix is set the \matlab current directory to the directory of codes (\noteFile and \cacofonixFile).

\section{Tutorial}

To see how \cacofonix works, we will try to transcode this sheet (\frerejaques, a famous French nursery melody):\\
\begin{lilypond}
	\relative c'' { \new Staff { \key g \major \time 2/4 g4 a b g b c d2 d8. e16 d8 c b4 g g d g2 } }
\end{lilypond}

\subsection{Dummy code}

To create a playable note, you have to create two \note objects, one for the tonality, one for the duration, and associate them with the operator \lstinline!:!:
\begin{lstlisting}
mynote = Note('G'):Note(1);
\end{lstlisting}
This instruction creates a G quarter note (\lstinline!Note(4)! for a whole note). Per default, a note without tonality is a rest (but it's a good idea to use \lstinline!Note('rest')!), and, well, a note without duration is not played.

To have a G note (or any other note\dots) of an another octave, you have to use the unary operators \lstinline!-! and \lstinline!+!. \\
\begin{lilypond}
	\relative c' { \new Staff { b1 c a' c c'} }
\end{lilypond}
\begin{lstlisting}
sheet = [ ...
	-Note('B'):Note(4) ...
	Note('C'):Note(4) ...
	Note('A'):Note(4) ...
	+Note('C'):Note(4) ...
	++Note('C'):Note(4) ];
\end{lstlisting}

A complete sheet is just an array of \note objects. So, this is a first (and very dummy) version of \frerejaques:
\begin{lstlisting}
sheet = [ ...
	Note('G'):Note(1) Note('A'):Note(1) ...
	Note('B'):Note(1) Note('G'):Note(1) ...
	Note('B'):Note(1) +Note('C'):Note(1) ...
	+Note('D'):Note(2) ...
	+Note('D'):Note(3/4) +Note('E'):Note(1/4) ...
	+Note('D'):Note(1/2) +Note('C'):Note(1/2) ...
	Note('B'):Note(1) Note('G'):Note(1) ...
	Note('G'):Note(1) Note('D'):Note(1) ...
	Note('G'):Note(2) ];
\end{lstlisting}

The final step, to create the midi files, is call the \lstinline!cacofonix! function, with setting the name of the file and the tempo:
\begin{lstlisting}
cacofonix( 'FrereJacques', 'Tempo', 100, sheet );
\end{lstlisting}

Theoretically, a file \file{FrereJacques.mid} has been created in the current directory and you can open it with your favorite player.

\subsection{Predefinition of some \note objects}

A way of simplifying the writing of a sheet is predefine some \note objects. Two scripts are proposed to initialize \matlab before the creation of sheets: \noteInitFile and \noteInitFrFile. Of course, with a little practrice, you should be able to create your own initialization file. This is an extract of \noteInitFile:
\begin{lstlisting}
R = Note( 'rest' );

Cf = Note( 'Cf' ); C = Note( 'C' ); Cs = Note( 'Cs' );
Df = Note( 'Df' ); D = Note( 'D' ); Ds = Note( 'Ds' );
Ef = Note( 'Ef' ); E = Note( 'E' ); Es = Note( 'Es' );
Ff = Note( 'Ff' ); F = Note( 'F' ); Fs = Note( 'Fs' );
Gf = Note( 'Gf' ); G = Note( 'G' ); Gs = Note( 'Gs' );
Af = Note( 'Af' ); A = Note( 'A' ); As = Note( 'As' );
Bf = Note( 'Bf' ); B = Note( 'B' ); Bs = Note( 'Bs' );

N = Note( 4 );
N2 = Note( 2 );
N4 = Note( 1 );
N8 = Note( 1/2 );
N16 = Note( 1/4 );
N12 = Note( 1/3 );
\end{lstlisting}

So, including this file, \frerejaques becomes:
\begin{lstlisting}
NoteInit
N8dotted = Note( 3/4 );

sheet = [ ...
	G:N4 A:N4 ...
	B:N4 G:N4 ...
	B:N4 +C:N4 ...
	+D:N2 ...
	+D:N8dotted +E:N16 +D:N8 +C:N8 ...
	B:N4 G:N4 ...
	G:N4 D:N4 ...
	G:N2 ];
\end{lstlisting}

\me{Nice. Why each measure is on a line? Again a whim?}
\myself{I think it's a good practice to separate each measure on a different line: bigger projects become more readable, specially with the bars and markers functionalities of \note.}

\subsection{Bars}

\cacofonix is able to check some common mistakes, like a measure with the wrong duration, but it needs bars.

A bar object is constructed with \lstinline!Note('bar')!. It's a very useful feature, so a \lstinline!bar! object is defined in \noteInitFile.

With bars, our example becomes:
\begin{lstlisting}
NoteInit
N8dotted = Note( 3/4 );

sheet = [ ...
	G:N4 A:N4 bar ...
	B:N4 G:N4 bar ...
	B:N4 +C:N4 bar ...
	+D:N2 bar ...
	+D:N8dotted +E:N16 +D:N8 +C:N8 bar ...
	B:N4 G:N4 bar ...
	G:N4 D:N4 bar ...
	G:N2 bar ];
\end{lstlisting}

\me{Always adding \lstinline!bar! at each measure, it's a little boring, isn't it?}
\myself{Yes. But something like \exchange{EditorMacro}{http://www.mathworks.com/matlabcentral/fileexchange/24615} (and probably the new \exchange{\matlab editor API}{http://blogs.mathworks.com/desktop/2011/05/16/matlab-editor-api-examples/}) can be helpful.}

\subsection{Dotted notes}
\label{sec:TutoDottedNotes}

In the last version of \frerejaques, a special \note object has been created to represent a dotted eighth note: \lstinline!N8dotted = Note(3/4);!, but the operator \lstinline!ctranspose! (\lstinline!'!) can be used to add the half duration of the note. For example: \\
\begin{lilypond}
	\relative c'' { \new Staff { \time 2/4 g4. g8 g8. g16 g8. g16 g4.. g16 } }
\end{lilypond}

\begin{lstlisting}
NoteInit

sheet = [ ...
	G:N4' G:N8 bar ...
	G:N8' G:N16 G:N8' G:N16 bar ...
	G:N4'' G:N16 bar ];
\end{lstlisting}

\subsection{Ties and slurs}

Ties and slurs are written with the same operator: \lstinline!not! (\lstinline!~!). The operator can be used on one note to merge it with the previous: \lstinline![G:N2 ~G:N8]!. The operator can also be used on an array of notes to play legato: \lstinline!~[C:N4 E:N4 G:N4 +C:N4]!.

\me{There are an another way to create a note with an exotic duration.}
\begin{myselfenv}%
	Yes, but the good way is always use the operators \lstinline!'! and \lstinline!~!.%
\end{myselfenv}
\begin{meenv}%
	And the convenient way is use an array for the duration with the operator \lstinline!:!, like that: \lstinline!G:[N4 N16]!.%
\end{meenv}

\subsection{Chord}

A chord is a note with several tonalities and one duration. There are two ways to create a chord: a good one, the operator \lstinline!plus! (\lstinline!+!), and a bad-but-sometimes-convenient one, using an array with the operator \lstinline!colon! (you know, \lstinline!:!). \\
\begin{lilypond}
	\relative c' { \new Staff { \time 2/4 <c e g c>2 <g' b d g> <c, e g c> <g' b d g>4 ~ <g b d g>8 ~ <g b d g> } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ ...
	C+E+G++C:N2 bar ...
	G+B++D++G:N2 bar ...
	[C E G +C]:N2 bar ...
	[G B +D +G]:[N4 N8 N8] bar ];
\end{lstlisting}

\myself{Something to say?}
\me{No.}
\myself{Good.}

\subsection{Polyphonic sections}
\label{sec:TutoPolyphonic}

A polyphonic section is a set of sheets with the same duration and played at the same time. To create a polyphonic sheet, the \emph{monophonic} sheets have to be combined with the operator \lstinline!mrdivide! (\lstinline!/!). \\
\begin{lilypond}
\new GrandStaff <<
	\new Staff { \time 3/4 \relative c'' <<
		{ c2. <c, e g c>2. } \\
		{ c4( e g) s2. }
		>> }
	\new Staff { \clef bass \relative c { c2. ~ c } }
>>
\end{lilypond}
\begin{lstlisting}
NoteInit
sheet = [ ( +C:N2' ) / ~[ C:N4 E:N4 G:N4 ] bar ...
	[ C E G +C ]:N2' bar ] / ...
	[ -C:N2' bar ~-C:N2' bar ];
\end{lstlisting}

\begin{meenv}%
It's too bad: there are no polyphonic section in \frerejaques.%
\end{meenv}
\begin{myselfenv}%
Yes, but it's nice in a canon:

\begin{lstlisting}
>> NoteInit
>> sheet = [ ...
	G:N4 A:N4 bar ...
	B:N4 G:N4 bar ...
	B:N4 +C:N4 bar ...
	+D:N2 bar ...
	+D:N8' +E:N16 +D:N8 +C:N8 bar ...
	B:N4 G:N4 bar ...
	G:N4 D:N4 bar ...
	G:N2 bar ];
>> delay = [ N2 bar N2 bar ];
>> cacofonix( 'FrereJacques', 'Tempo', 100, ...
	[ sheet delay ] / [ delay sheet ] );
\end{lstlisting}%
\end{myselfenv}

\subsection{Display}

A good way for checking errors is display the sheet: the function \lstinline!display! has been overloaded to represent the sheet. This is the display of \frerejaques:
\begin{lstlisting}
>> NoteInit
>> sheet = [ ...
	G:N4 A:N4 bar ...
	B:N4 G:N4 bar ...
	B:N4 +C:N4 bar ...
	+D:N2 bar ...
	+D:N8' +E:N16 +D:N8 +C:N8 bar ...
	B:N4 G:N4 bar ...
	G:N4 D:N4 bar ...
	G:N2 bar ];
>> sheet
$1///////////////////////////////////////////////$
$|-----------G-----------|-----------A-----------$
$2///////////////////////////////////////////////$
$|-----------B-----------|-----------G-----------$
$3///////////////////////////////////////////////$
$|-----------B-----------|-----------C-----------$
$4///////////////////////////////////////////////$
$|-----------------------D-----------------------$
$5///////////////////////////////////////////////$
$|--------D--------|--E--|-----D-----|-----C-----$
$6///////////////////////////////////////////////$
$|-----------B-----------|-----------G-----------$
$7///////////////////////////////////////////////$
$|-----------G-----------|-----------D-----------$
$8///////////////////////////////////////////////$
$|-----------------------G-----------------------$
\end{lstlisting}

New lines are set according to bars, and a lot of stuff can be displayed: chords, polyphonic sheet, meters, markers, dynamics, tempo\dots Only note's octave and pitch\footnote{Wait the section \ref{sec:Pitch} for more explanations about pitch.} are never displayed.

To set the number of characters per quarter note, you have to use the class function \lstinline!setNbCharByQuater! (\eg \lstinline!Note.setNbCharByQuater(48)! --- the default value is 24).

\subsection{A little more about the \lstinline!cacofonix! function}

As you know, the \lstinline!cacofonix! function writes the final file. It is possible to give several sheets: to do that, you have to precise the wanted instrument before the sheet. Suppose you have two sheets, \lstinline!sheet_violin! and \lstinline!sheet_trumpet!:
\begin{lstlisting}
cacofonix( 'myFile.mid', 'Tempo', 100, ...
	'Violin', sheet_violin, ...
	'Trumpet', sheet_trumpet )
\end{lstlisting}

To know the list of available instruments, type \lstinline!cacofonix -instruments!. You can't play more than fifteen instruments, but with possibilities to set several sheets for one instrument (the operator \lstinline!/! is one of them).

Some percussions are available too, type \lstinline!cacofonix -percussions! to know the list. However, percussion sheets can't have tonality: instead of using tonality notes (\lstinline!Note('G')!), you have to use the void note: \lstinline!V=Note('void')!. There are no restriction about the number of percussion sheet.

\subsection{And now?}

Well, we have a nice version of \frerejaques:
\begin{lstlisting}
NoteInit
sheet = [ ...
	G:N4 A:N4 bar ...
	B:N4 G:N4 bar ...
	B:N4 +C:N4 bar ...
	+D:N2 bar ...
	+D:N8' +E:N16 +D:N8 +C:N8 bar ...
	B:N4 G:N4 bar ...
	G:N4 D:N4 bar ...
	G:N2 bar ];
cacofonix( 'FrereJacques', 'Tempo', 100, sheet );
\end{lstlisting}

\me{Hurray!}

We have seen in this tutorial only very basic features of \cacofonix, but it's probably enough for start.

The script \file{ForElise.m} is a good demonstration of the possibilities of \cacofonix: you can see different attacks, markers, dynamics, tempo, sustain\dots The next section will explain more precisely all the features of \cacofonix.

Thank you to have read this document, and for your interest about \cacofonix.

\myself{Enjoy!}

\section{Reference guide}

\subsection{Overview}

In this reference guide, we will see every possibilities to transcribe any sheet the most quickly and faithfully as far as it can be. We suggest to have read the tutorial before start the next sections.

The first introductive sections will be about important and general key concepts of \cacofonix. From section \ref{sec:Tonalities}, we will see the \emph{advanced usages of the basic features}. Then, from the section \ref{sec:Transpose}, we will gently study the \emph{insane usages of the weird features}. Finally, we will finish with the API\footnote{\emph{Application Programming Interface}} of the \lstinline!cacofonix! function.

\me{I feel it will be \dots BOOOOOOOORING!}
\myself{Well, your analysis is short and simplistic, but correct. The point is: if you want to play \emph{Three Blind Mice}, you have everything you need in the tutorial. If you want to play the Schubert's \emph{Trout Quintet}, you should read carefully this guide.}

To search of a particular point, three tables can help: all features concerning a special use of the \note constructor are in table \ref{tab:NoteAPI}, member functions and operators are listed in the table \ref{tab:NoteFunctions} and the \lstinline!cacofonix! function API is on the table \ref{tab:CacofonixAPI}. Theses tables have a column Scope (explained at the section \ref{sec:scope}): N means note, M means monophonic, C means channel and G means global.

\begin{table}
	\centering
	\begin{tabular}{llcl}
		Contructor syntax & Description & Scope & Section \\
		\hline
		\lstinline!Note( tonality )! & tonality & N & \ref{sec:Tonalities} \\
		\lstinline!Note( duration )! & duration & N & \ref{sec:Duration} \\
		\lstinline!Note( '+X'|'-X' )! & octave & M & \ref{sec:OctaveNote} \\
		\lstinline!Note( 'bar' )! & bars & M & \ref{sec:MetersAndBars} \\
		\lstinline!Note( [upper lower] )! & meters & G & \ref{sec:MetersAndBars} \\
		\lstinline!Note( 'dynamics', dyn, [ d ] )! & dynamics & M & \ref{sec:Dynamics} \\
		\lstinline!Note( 'dynamics*', dyn, [ d ] )! & channel dynamics & C & \ref{sec:ChannelDynamics} \\
		\lstinline!Note( 'cresc', dur, dyn, [ d ] )! & crescendo & M & \ref{sec:Crescendo} \\
		\lstinline!Note( 'cresc*', dur, dyn, [ d ] )! & channel crescendo & C & \ref{sec:ChannelDynamics} \\
		\lstinline!Note( 'tempo', tempo )! & tempo & G & \ref{sec:Tempo} \\
		\lstinline!Note( 'accel', dur, tempo )! & accelerando & G & \ref{sec:AccelerandoRallentando} \\
		\lstinline!Note( 'fermata', dur, play )! & fermata & G & \ref{sec:Fermata} \\
		\lstinline!Note( 'sustain', 'on'|'off' )! & sustain & C & \ref{sec:Sustain} \\
		\lstinline!Note( 'marker', mark )! & marker & G & \ref{sec:Markers} \\
		\lstinline!Note( 'marker*', mark )! & goto marker & M & \ref{sec:Goto} \\
		\lstinline!Note( 'pitch', [ t ], val, [ d ] )! & pitch wheel & C & \ref{sec:Pitch} \\
		\lstinline!Note( 'void' )! & void note & N & \ref{sec:VoidNote} \\
	\end{tabular}
	\caption[\note constructor API]{\note constructor API.}
	\label{tab:NoteAPI}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{lllcl}
		Member function & Operator & Description & Scope & Section \\
		\hline
		\lstinline!plus! & \lstinline!+! & chord & N & \ref{sec:Chord} \\
		\lstinline!uplus!, \lstinline!uminus! & \lstinline!+!, \lstinline!-! & octave & N & \ref{sec:OctaveOperators} \\
		\lstinline!colon! & \lstinline!:! & set duration & N & \ref{sec:SetDuration} \\
		\lstinline!ctranspose! & \lstinline!'! & dot & N & \ref{sec:DottedNotes} \\
		\lstinline!not! & \lstinline!~! & tie & N & \ref{sec:TiesAndSlurs} \\
		\lstinline!mrdivide! & \lstinline!/! & polyphonic section & N & \ref{sec:Polyphony} \\
		\lstinline!or! & \lstinline!|! & extraction & C & \ref{sec:Extraction} \\
		\lstinline!mpower! & \lstinline!^! & transposition & N & \ref{sec:Transpose} \\
		\lstinline!mtimes! & \lstinline!.*! & riff & N & \ref{sec:RepeatRiff} \\
		\lstinline!display!& & display & C & \ref{sec:Display} \\
		\lstinline!times! & \lstinline!*! & expand & N & \ref{sec:Expand} \\
		\lstinline!minus! & \lstinline!-! & index & N & \ref{sec:Index} \\
	\end{tabular}
	\caption[\note member functions]{\note member functions.}
	\label{tab:NoteFunctions}
\end{table}

\begin{table}
	\centering
	\begin{tabular}{llcl}
		\lstinline!cacofonix! function syntax & Description & Scope & Section \\
		\hline
		\lstinline!cacofonix( file, ... )! & output file & & \ref{sec:CacofonixFunction} \\
		\lstinline!cacofonix( ..., instrument, sheet, ... )! & add sheets & C & \ref{sec:CacofonixFunction} \\
		\lstinline!cacofonix( ..., 'Tempo', tempo, ... )! & default tempo & G & \ref{sec:Tempo} \\
		\lstinline!cacofonix( ..., 'Velocity', velocity, ... )! & velocity & G & \ref{sec:Velocity} \\
		\lstinline!cacofonix( ..., 'DrumKit', drumkit, ... )! & drum kit & G & \ref{sec:CacofonixFunction} \\
	\end{tabular}
	\caption[\lstinline!cacofonix! function API]{\lstinline!cacofonix! function API.}
	\label{tab:CacofonixAPI}
\end{table}

\subsection{Sheets, instruments, tracks and channels}
\label{sec:SITandC}

For \cacofonix, the transcription of a sheet is realized with an array of \note objects. In all this document, we call a sheet a coherent array of \note for \cacofonix.

In the midi files, a track is a list of events: play that note, play stronger, use the pitch wheel\dots In fact, a track is the midi side of a sheet: \cacofonix writes each sheet in a track, and a track contains only one sheet. The number of tracks is not limited.

A channel is another midi concept: each channel has, among other things, an instrument timbre, a volume and is controlled by one or several tracks. It's a kind of out of one instrument, but all percussions are regrouped in one (and only one) channel. Midi specifications allow only sixteen channels: fifteen for regular instruments and one for percussions.

Last rule of the game: \cacofonix doesn't allow to modify the instrument in a sheet.

\paragraph{}

So.

\paragraph{}

\emph{One} sheet is written for \emph{one} instrument. It's still true for a drum set: each element of the drum set (bass drum, toms, hi-hat, cymbals\dots) and more generally each percussion have to has it's own sheet, with void notes (see \ref{sec:VoidNote}) instead of tonality notes.

The reciprocal is not true: \emph{one} instrument can have \emph{several} sheets. Either each sheet has its own track, or sheets are merged in the same track with the operator \lstinline!mrdivide! (\lstinline!/!). The two solutions produce exactly the same audible result. The section \ref{sec:CacofonixFunction} describes how create a channel and link it with tracks (in other words: how associate an instrument with sheets).

\subsection{The scope}
\label{sec:scope}

For each features of \cacofonix, there is four possible scopes: note, monophonic, channel or global.
\begin{itemize}
	\item A feature with a note scope will modify only one note (or sometimes, an array of notes), and the next notes are not influenced.
	\item A feature with a monophonic scope is a little more complicated. This kind of features modify the next notes of the monophonic part\footnote{It's a sad misuse of language: a polyphonic section is said composed of \emph{monophonic} parts, even if a monophonic part can contains polyphonic sections itself.}. If the feature is placed in a monophonic section, the other monophonic parts (which are played in parallel) are not modified, influenced or perturbed, in any way. If, in the monophonic part and after the modification, a new polyphonic section starts, the feature will be apply in every new monophonic parts. Last point: after the polyphonic section, the last modification of the last written monophonic part will be active. This is a good example (see section \ref{sec:PlainDynamics} for explications about dynamics):
\begin{lstlisting}
NoteInit
sheet = [ C:N bar ...      % dyn: mf (default)
	DynF D:N bar ...       % dyn: f  (setted)
	[ ...                  % start a mono. section
		E:N bar ...        % dyn: f
		DynMP F:N bar ...  % dyn: mp (setted)
		G:N bar ...        % dyn: mp (not modified)
		A:N bar ...        % dyn: mp (not modified)
	] ...                  % end of the mono. section
	/ ...                  % polyphony
	[ ...                  % new mono. section
		+E:N bar ...       % dyn: f
		+F:N bar ...       % dyn: f  (not modified)
		DynPP +G:N bar ... % dyn: pp (setted)
		+A:N bar ...
	] ...                  % end of the poly. section
	+C:N bar ...           % dyn: pp
	];
\end{lstlisting}
	\item A feature with a channel scope modify\dots the channel, and so all played sheets of the modified instrument at the same time. Be careful: remember that percussions share the same channel!
	\item Finally, a feature with a global scope modify all sheets given to the \lstinline!cacofonix! function. For more readability, theses features can be grouped in a main sheet, see the section \ref{sec:CacofonixFunction}.
\end{itemize}

\me{I not sure to understand\dots}
\myself{A feature with a note scope modify a note. When it's a monophonic scope, that modify the monophonic section. A channel scope modify the channel, and a global feature modify all sheets. It's almost logical.}
\me{Yes, but the monophonic scope seems tricky.}
\myself{Don't be stressed out. There are more difficult to understand latter.}

\subsection{Tonalities}
\label{sec:Tonalities}

To create a tonality \note object, you simply have to call the constructor with a string containing the name of the expected note. The basic names are \lstinline!'rest'! for a rest, \lstinline!'void'! for a void note (see section \ref{sec:VoidNote}), \lstinline!'do'!, \lstinline!'re'!, \lstinline!'mi'!, \lstinline!'fa'!, \lstinline!'sol'!, \lstinline!'la'!, \lstinline!'si'! and \lstinline!'a'!, \lstinline!'b'!, \lstinline!'c'!, \lstinline!'d'!, \lstinline!'e'!, \lstinline!'f'! and \lstinline!'g'!. You can add one or two \lstinline!'b'! (\emph{b\'emol}, flat) or \lstinline!'d'! (\emph{di\`ese}, sharp) after \lstinline!'do'!, \lstinline!'re'!, \lstinline!'mi'!\dots and you can add one or two \lstinline!'f'! or \lstinline!'s'! after \lstinline!'a'!, \lstinline!'b'!, \lstinline!'c'!\dots The constructor is case insensitive.

In \noteInitFile and \noteInitFrFile files, only notes with none or one accident are instanced, but something like \lstinline!Eff = Note( 'Eff' );! is completely valid.

\subsection{Duration}
\label{sec:Duration}

To create a duration \note object, you have to call the constructor with a double, which will be the duration of the note, in number of beats: \lstinline!Note(4)! for a whole note, \lstinline!Note(1)! for a quarter note. Per default, a duration note which has not been associated with a tonality note is a rest.

\noteInitFile and \noteInitFrFile define some useful duration: the whole note to the sixteenth note and the triplet quarter note.

\subsection{Chord \lstinline!+!}
\label{sec:Chord}

In the tutorial, the binary operator \lstinline!plus! (\lstinline!+!) is used to create chords, but this operator is more general. It merge two notes (or two array of notes) in one object: tonalities are recorded as a chord and durations are summed.

\myself{The script can become messy very quickly if this operator is not correctly used.}
\me{Yes, there is a lot of possibilities: \lstinline!C+N2+E+N8+G!, or \lstinline![C N2]+[E N8]+G!, or \lstinline!C+[N2 E+[N8 G]]!\dots It's awesome.}
\myself{Every time you don't use that operator correctly and neatly, you make Jesus cry and God kills a kitten.}

The final note is tied, detached or arpeggiated if in the two arrays, at least on note is tied, detached or arpeggiated. See the section \ref{sec:TiesAndSlurs} for more informations about ties and detached notes and the section \ref{sec:SetDuration} for arpeggios.

% \me{Arpeggios? Arpeggi?}
% \myself{\wikipedia gives both\footurl{http://en.wikipedia.org/wiki/Arpeggio}, \wiktionary gives only arpeggios\footurl{http://en.wiktionary.org/wiki/arpeggio}. \google finds 3 820 000 results for argeggios and only 634 000 for arpeggi. The \textsc{Oxford Dictionaries} and The \textsc{Cambridge Dictionaries Online} suggest only arpeggios\footurl{http://oxforddictionaries.com/definition/arpeggio}\footurl{http://dictionary.cambridge.org/dictionary/british/arpeggio}. Arpeggios win.}

\subsection{Octave}
\label{sec:Octave}

There are two ways to add or subtract an octave to a note: the unary operators \lstinline!+! and \lstinline!-! and a special note.

\subsubsection{Octave (operators \lstinline!+! and \lstinline!-!)}
\label{sec:OctaveOperators}

The simplest way to modify the octave of a note is the unary operators \lstinline!+! and \lstinline!-!. Some examples: \\
\begin{lilypond}
\relative c' { \new Staff { \time 4/4 g2 c e g a b c c' <e,,, g c c''>1 } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ ...
	-G:N2 C:N2 bar ...
	E:N2 G:N2 bar ...
	A:N2 B:N2 bar ...
	+C:N2 ++C:N2 bar ...
	-E+-G+C+++C:N bar ];
\end{lstlisting}

\begin{meenv}%
The operators \lstinline!+! and \lstinline!-! can be used on array. So, instead of:
\begin{lstlisting}
sheet = [ +C:N bar +E:N bar +G:N bar ];
\end{lstlisting}
we can write:
\begin{lstlisting}
sheet = +[ C:N bar E:N bar G:N bar ];
\end{lstlisting}%
\end{meenv}
\myself{Yes, but maybe the special note for the octave is more convenient.}

\subsubsection{Octave (note)}
\label{sec:OctaveNote}

Sometimes, a sheet or a section of a sheet is naturally high or low pitched. So, instead of add \lstinline!+! or \lstinline!-! behind each note
\myself{\dots or use it on an array like a tramp \dots} \\
\dots you can add a special note which means the default octave. To create a note which raises of $n$ octaves, you have to call the constructor \note with a string \lstinline!'+n'! (\eg, \lstinline!Note('+2')! to raise of two octaves). Use a string \lstinline!'-n'! to lower of $n$ octaves. To restore the default octave, you can use \lstinline!Note('+0')! or \lstinline!Note('-0')!. \\
\begin{lilypond}
\relative c' { \new Staff { \time 4/4 g4 a d f, g a d f, g'' f a g g, f a g } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ ...
	          -G:N4 -A:N4  D:N4 -F:N4 bar ...
	Note('-1') G:N4  A:N4 +D:N4  F:N4 bar ...
	Note('+1') G:N4 F:N4 A:N4 G:N4 bar ...
	Note('+0') G:N4 F:N4 A:N4 G:N4 bar ];
\end{lstlisting}

\myself{I guess you would talk about the other way to create this kind of \note?}
\me{Yeah. Instead of using a \lstinline!'+n'! form, you can create a string repeating \lstinline!'+'! $n$ times, like that: \lstinline!Note('+++')! instead of \lstinline!Note('+3')!. Obviously it's also working with \lstinline!'-'!, and it's working even if $n$ means $0$: \lstinline!Note('')! is equivalent at \lstinline!Note('+0')!!}

\subsection{Set duration \lstinline!:!}
\label{sec:SetDuration}

Officially, the operator \lstinline!colon! (\lstinline!:!) associates a tonality note (or an array of tonality notes) with a duration note (or an array of duration notes):
\begin{lstlisting}
>> mynote = tonality:duration;
\end{lstlisting}

In fact, the operator \lstinline!:! is like the operator \lstinline!+!: it merges two array of notes in the same way. The difference is the optional argument, a string which is composed with the characters of the table \ref{table:charsOfColon}: only one accent can be specify (\lstinline!'>'!, \lstinline!'.'!, \lstinline!'^'! or \lstinline!'-'!), the characters \lstinline!'|'!, for a detached note, and \lstinline!'$'!, for an arpeggiated chord, can be added after or before (for more information about detached notes, see the section \ref{sec:TiesAndSlurs}). If the note is tied (and not detached), the arpeggio is ignored.

\begin{table}
	\center
\begin{tabular}{ccp{7cm}}
\lstinline!'>'! & accent & raise the dynamics of the note \\
\lstinline!'.'! & staccato & the note is played only during the half of its duration \\
\lstinline!'^'! & marcato & like an accent and a staccato \\
\lstinline!'-'! & tenuto & like an accent and the delay between the previous note and this one is risen \\
\lstinline!'|'! & detached & the note is detached, even if it is tied \\
\lstinline!'$'! & arpeggio & the chord is arpeggiated. \\
\end{tabular}
\caption{Characters composing the optional string of the operator \lstinline!:!}
\label{table:charsOfColon}
\end{table}

Some examples: \\
\begin{lilypond}
	\new Staff { \time 4/4 \relative c'' { c4\accent b\staccato a\marcato g\tenuto c,4( ~ c8 g'8 g2\accent ) } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ ...
	+C:'>':N4 B:'.':N4 A:'^':N4 G:'-':N4 bar ...
	~[ C:N4 C:N8 G:N8 G:'|>':N2 ] bar ];
\end{lstlisting}

\subsection{Dotted notes \lstinline!'!}
\label{sec:DottedNotes}

The operator \lstinline!ctranspose! (\lstinline!'!) raises the duration of the note, as a dot: one \lstinline!'! increases the duration of the note by half of its original value, $n$ \lstinline!'! serve to lengthen the note by $1 - \frac{1}{2^n}$ of its original duration. For example: \\
\begin{lilypond}
	\relative c'' { \new Staff { \time 2/4 g4. g8 g8. g16 g8. g16 g4.. g16 } }
\end{lilypond}

\begin{lstlisting}
NoteInit

sheet = [ ...
	G:N4' G:N8 bar ...
	G:N8' G:N16 G:N8' G:N16 bar ...
	G:N4'' G:N16 bar ];
\end{lstlisting}

\me{It's exactly the same example as the section \ref{sec:TutoDottedNotes}!}
\myself{Yes, but it's not the same explanation. And it's a good example.}

\subsection{Ties and slurs \lstinline!\~!}
\label{sec:TiesAndSlurs}

The operator \lstinline!not! (\lstinline!~!) is used to defined ties and slurs. Technically, the note preceding a tied note is played for all its duration, and the notes are merged if they have the same tonality. Sometimes, during a slur, two notes with the same tonality can be juxtaposed: \cacofonix will merge them, unless if the second note precise an attack with the \lstinline!'|'! character (the note is \emph{detached}).

If the operator \lstinline!not! is applied on an array of \note, all \note objects in the array will be tied. In this case, the array can contain not playable \note objects (like bars, meters, crescendo\dots): the operator will ignore them. This is some examples: \\
\begin{lilypond}
	\relative c'' { \new Staff { \time 4/4 g4( g) f( a) g( g) f( a) g\( ^( g) f a \) g\( g f a g1 \) } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ ...
	G:N4 ~G:N4 F:N4 ~A:N4 bar ...
	~[ G:N4 G:N4 ] ~[ F:N4 A:N4 ] bar ...
	G:N4 ~G:N4 ~F:N4 ~A:N4 bar ...
	~[ G:N4 G:'|':N4 F:N4 A:N4 bar ...
	G:N ] bar ];
\end{lstlisting}

\begin{meenv}%
The operator \lstinline!~! has an other very specific application: it changes a \emph{marker} to a \emph{goto marker}. See the section \ref{sec:Goto} for more details.%
\end{meenv}

\subsection{Meters and bars}
\label{sec:MetersAndBars}

To defined a meter, you have to instantiate a special \note object by calling the constructor \note with an array of two double \lstinline!meter = Note([upper lower])!. Without surprise, the double \lstinline!upper! indicates how many beats there are in a measure and the double \lstinline!lower! indicates the note value which represents one beat.

\lstinline!Note('bar')! creates an object representing a bar, and you use it every time you have to separate two measures. You can add bars in tied arrays, in repeated sections (see \ref{sec:RepeatRiff}), or in expandable sections (see \ref{sec:Expand}).

When several sheets are given to \cacofonix, the first sheet defined the meters. Next sheets have to precise bars, but not meters (meters are in the global scope, although bars are only in the monophonic scope). If another sheet specify meters, the meters can't be different from the first sheet. With the same spirit, in polyphonic sections, bars have to be added everywhere and, if the meters have to be defined, the first monophonic section contains meters objects and the others don't have to, but if they do, meters have to be always identical.

The first measure duration is never checked, to allow anacrusis. If no meter is given, the second measure is the reference and all measure have to have the same duration. Even if the first measure is an anacrusis, the other measures have to always have the same duration, or the meter has to be redefined.

\begin{lilypond}
\new GrandStaff <<
\new Staff { \clef treble \relative c' { \time 6/8 \partial 4 r8 <g e'> <c e g>8 <c e g> <c e g> <e g c> <e g c> <e g c> \time 3/4 <c f a>4 <a c f> <f a c> \time 6/8 <c' e g>8 <c e g> <c e g> <e g c> <e g c> <e g c> \time 3/4 <g b d>4 <d g b> <b d g> } }
\new Staff { \clef bass \relative c, { c8 r c r r g r r c g' g, g' c, g' c, r r g r r c g' g, g' c, g' } } >>
\end{lilypond}

\begin{lstlisting}
NoteInit
meter68 = Note( [6 8] );
meter34 = Note( [3 4] );

longmeasure = [ ...
	C+E+G:N8 C+E+G:N8 C+E+G:N8 ...
	E+G++C:N8 E+G++C:N8 E+G++C:N8 ];

sheet = [ meter68 R:N8 -G+E:N8 bar ...
	longmeasure bar ...
	meter34 C+F+A:N4 -A+C+F:N4 -F+-A+C:N4 bar ...
	meter68 longmeasure bar ...
	meter34 G+B++D:N4 D+G+B:N4 -B+D+G:N4 bar ...
	] / [ ...
	Note('--') C:N8 R:N8 bar ...
	C:N8 R:N8 R:N8 -G:N8 R:N8 R:N8 bar ...
	C:N8 G:N8 -G:N8 G:N8 C:N8 G:N8 bar ...
	C:N8 R:N8 R:N8 -G:N8 R:N8 R:N8 bar ...
	C:N8 G:N8 -G:N8 G:N8 C:N8 G:N8 bar ];
	

cacofonix( 'America', 'Tempo', 140, sheet );
\end{lstlisting}

\me{You don't have to use meters and bars.}
\myself{Here we go\dots}
\me{It's true: any midi files \cacofonix can produce, you can make the same results with or without.}
\begin{myselfenv}%
	OK, yes, you're right. Adding bars is boring: you spend time for something which don't appear in the final midi file. But, sometimes, you have thinking about something else, and you have get the wrong duration on several notes. Then, you spend \emph{a lot} of time to find where is the mistake on the sheet, correct the code, re-launch \cacofonix and replay the midi files until the next error. Well, with bars, you can still get the wrong tonality of course, but get the wrong duration makes nicely crash \cacofonix, and the error message gives you what is the problematic measure. Look at that:
\begin{lstlisting}
>> NoteInit
>> cacofonix('dumass', [ Note([4 4]) C:N4 bar E:N4 bar G:N bar ])
??? Error using ==> cacofonix
The measure 2 of the sheet 1 is incorrect.
\end{lstlisting}%
\end{myselfenv}
\me{Humpf.}

\subsection{Dynamics}
\label{sec:Dynamics}

Dynamics are really important: they add all the expressiveness.
\me{\dots as far as midi files can be played with expressiveness.}

\subsubsection{Plain dynamics}
\label{sec:PlainDynamics}

\begin{table}
	\centering
	\begin{tabular}{rll}
		\lstinline!'inf'! & & loudest possible \\
		\lstinline!'fff'! & forteissimo possibile & very \emph{very} loud \\
		\lstinline!'ff'! & fortissimo & very loud \\
		\lstinline!'f'! & forte & loud \\
		\lstinline!'mf'! & mezzo-forte & moderately loud (default) \\
		\lstinline!'mp'! & mezzo-piano & moderately soft \\
		\lstinline!'p'! & piano & soft \\
		\lstinline!'pp'! & pianissimo & very soft \\
		\lstinline!'ppp'! & pianissimo possibile & softest possible \\
		\lstinline!'0'! & & silence \\
	\end{tabular}
	\caption{Strings for dynamics}
	\label{tab:dynamics}
\end{table}

To start a section with a precise dynamic, you just have to add a special note: \lstinline!Note('dynamics',dyn)!, where \lstinline!dyn! is a string found in the table \ref{tab:dynamics}. You can also create a dynamic note with a delay: \lstinline!Note('dynamics',dyn,delay)!. The delay is a double or a duration \note and the new dynamic will be effective only after this duration.

\myself{Two precisions: this kind of dynamics specify only how notes are attacked. Even with the delay parameter, you can't modify the dynamic of a note which has begun to be played. So, you can't play fun dynamics like \sfz.}
\me{\dots yet. The trick is at the section \ref{sec:ChannelDynamics}.}
\myself{The second point is about polyphony: plain dynamics have a monophonic scope, so every monophonic part can have a different current dynamic. It's very useful: in a sheet for piano, the right hand and the left hand can play differently.}
\me{But don't forget to specify changes everywhere!}

Plain dynamics, from \lstinline!'fff'! to \lstinline!'ppp'! are defined in \lstinline!NoteInit! and \lstinline!NoteInit_fr! scripts, in the variables \lstinline!DynFFF! to \lstinline!DynPPP!.

\subsubsection{Crescendo}
\label{sec:Crescendo}

To play a crescendo, you have to add a note created by \lstinline!Note( keyword, duration, dynamics )! or \lstinline!Note( keyword, duration, dynamics, delay )!:
\begin{itemize}
	\item \lstinline!keyword! can be \lstinline!'crescendo'!, \lstinline!'cresc'!, \lstinline!'decrescendo'! or \lstinline!'decresc'!.
		\me{Fun story: you can use indifferently these key words!}
	\item \lstinline!duration! can be a double or a duration \note which indicates the duration of the crescendo (or the decrescendo).
	\item \lstinline!dynamics! is a string from the table \ref{tab:dynamics}: it gives the final dynamic.
	\item \lstinline!delay! is an optional double or a duration \note. Like for the dynamic \note, the crescendo starts only after this duration (and ends at \lstinline!delay+duration!).
\end{itemize}

Like plain dynamics, \cacofonix looks at the current dynamic at the start of the note, and apply this dynamic only for the attack of the note. So you can't play crescendo or decrescendo on one note.

\subsubsection{The velocity}
\label{sec:Velocity}

To each dynamic corresponds a velocity: it's a value between $0$ and $127$ which specify the attack of the note, in the midi file. You can redefine the mapping: when you're calling the \cacofonix function, add two more parameters:
\begin{lstlisting}
cacofonix( filename, ..., 'Velocity', velocities, ... )
\end{lstlisting}
where \lstinline!velocities! is an array of $8$ values which gives the velocity values of dynamics \lstinline!'ppp'! to \lstinline!'fff'!. You can't set the velocities of the dynamics \lstinline!'0'! and \lstinline!'inf'!, which are always $0$ and $127$. The default values are $16$, $33$, $49$, $64$, $80$, $96$, $112$ and $126$.

\subsubsection{Channel dynamics}
\label{sec:ChannelDynamics}

When you create a \note object with \lstinline!'dynamics'!, \lstinline!'crescendo'!, \lstinline!'cresc'!, \lstinline!'decrescendo'! or \lstinline!'decresc'!, you specify only the attacks of next notes. But there is an other way to modify the dynamics: when you add \lstinline!*! at the end of these keywords (\eg \lstinline!'cresc*'!), you modify the volume of the instrument (or the volume of the \emph{channel}). It's pretty convenient for modify the dynamic of notes after the attack, but never forget that, in polyphonic sections, all monophonic sections will be influenced, as the other sheets associate to the same instrument, and it's only modify the volume, whereas a plain dynamic (without \lstinline!*!) is more realistic and can modify the volume and the timbre of the instrument.

Plain dynamics and channel dynamics are independent: even if the current plain dynamic is set, the current channel dynamic is not modify. Also, you can boost a plain dynamic with a channel dynamic, but the experience shown that mix the two kinds of dynamics is quickly messy and it's often a bad idea.

\subsubsection{Example}

This is a famous example using dynamics: \\
\begin{lilypond}
\new Staff { \key d \major \time 4/4 \relative c'' { fis2->\ff b,8\mp\< cis d e fis4.->\ff d8 fis4.-> d8 fis4.-> b,8 d b g d' << b1 { s4\> s s\! s } >> } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ Note([4 4]) Note('+') DynFF ...
	Fs:'>':N2 ...
	DynMP Note('cresc', N2, 'FF' ) ...
	-B:N8 Cs:N8 D:N8 E:N8 bar ...
	Fs:'>':N4' D:N8 Fs:'>':N4' D:N8 bar ...
	Fs:'>':N4' DynMF ...
	Note('dynamics*', 'FF' ) ...
	-B:N8 D:N8 -B:N8 -G:N8 D:N8 bar ...
	Note('decresc*', N, '0' ) -B:N bar ];

cacofonix( 'SwanLake', 'Tempo', 80, 'Flute', sheet );
\end{lstlisting}

Look at the switch plain/channel dynamic: the plain dynamic is reset (line 7) and the channel dynamics takes the old value of the plain (line 8).

\subsection{Tempo}
\label{sec:Tempo}

Two ways to set the tempo:
\begin{itemize}
	\item the tempo is constant: in this case, you can just add two input parameters at the calling of the \cacofonix function:
\begin{lstlisting}
cacofonix( filename, ..., 'Tempo', tempo, ... )
\end{lstlisting}
	\item the tempo is not constant: to set a new tempo, add in the sheet a note created with \lstinline!Note('tempo',tempo)!.
\end{itemize}

The tempo is independent of the meters: the double \lstinline!tempo! is always the number of quarter notes (\lstinline!Note(1)!) per minutes.

All sheets share the same tempo in the same time (tempo has a global scope), so you should set the tempo only in one sheet.

\subsubsection{Accelerando/Rallentando}
\label{sec:AccelerandoRallentando}

You can set a new tempo progressively with \lstinline!Note( keyword, duration, newTempo )!, where \lstinline!keyword! is \lstinline!'accelerando'!, \lstinline!'rallentendo'!, \lstinline!'accel.'!, \lstinline!'rall.'!, \lstinline!'accel'! or \lstinline!'rall'!, \lstinline!duration! is the transition duration (a double or a duration \note), and \lstinline!newTempo! is the final tempo, reached after the given duration.

\subsubsection{Fermata}
\label{sec:Fermata}

You can indicate a fermata with \lstinline!Note( 'fermata', duration, playedDuration )!: \lstinline!duration! is the duration of the fermata (on the sheet) and \lstinline!playedDuration! is wanted duration of the fermata with the current tempo. \lstinline!duration! and \lstinline!playedDuration! can be doubles or duration \note objects.

\myself{Generally, the \lstinline!playedDuration! is half bigger than \lstinline!duration!.}
\me{So, why the \lstinline!playedDuration! is not optional with a default value setted to \lstinline!1.5*duration!?}
\myself{Because I'm lazy. But it's on the todo list.}

\subsubsection{Example}

This is an example of the tempo features: \\
\begin{lilypond}
\new Staff { \tempo 4=80 \clef bass \key g \major \time 4/4 \relative c {
g''16 b, d, b' g' b, g' b, g' b, d, b' g' b, g' b, 
g' a, d, a' g' a, g' a, g' a, d, a' g' a, g' a,
fis' c d, c'_\markup{ \italic rall... } fis c fis c fis c d, c' fis c fis c
<g, b' g'>1\fermata } }
\end{lilypond}

\begin{lstlisting}
NoteInit
sheet = [ Note('-') Note('Tempo', 80) ...
	+G:N16 B:N16 D:N16 B:N16 ...
		+G:N16 B:N16 +G:N16 B:N16 ...
		+G:N16 B:N16 D:N16 B:N16 ...
		+G:N16 B:N16 +G:N16 B:N16 bar ...
	+G:N16 A:N16 D:N16 A:N16 ...
		+G:N16 A:N16 +G:N16 A:N16 ...
		+G:N16 A:N16 D:N16 A:N16 ...
		+G:N16 A:N16 +G:N16 A:N16 bar ...
	+Fs:N16 +C:N16 D:N16 +C:N16 ...
		Note( 'rall', N2', 60 ) ...
		+Fs:N16 +C:N16 +Fs:N16 +C:N16 ...
		+Fs:N16 +C:N16 D:N16 +C:N16 ...
		+Fs:N16 +C:N16 +Fs:N16 +C:N16 bar ...
	Note( 'fermata', N, N') -G+B++G:N bar ];

cacofonix( 'CelloSuite_Prelude', 'Cello', sheet );
\end{lstlisting}

\subsection{Polyphony \lstinline!/!}
\label{sec:Polyphony}

Polyphonic sections are really useful, in particular in the case where your instrument has the possibility to play several notes independently, like a piano with the right and left hands.

Polyphonic sections are easy to use: just merge two sheets with the operator \lstinline!mrdivide! (\lstinline!/!). The two sheets are called \emph{monophonic sections}, even if they contain smaller polyphonic sections. You can merge more than two sheets: to play \lstinline!sheet1!, \lstinline!sheet2!, \lstinline!sheet3!\dots at in the same time, just apply the operator to add each sheet: \lstinline!sheet1 / sheet2 / sheet3 /...! Only one rule: every sheet has to have the same total duration.

Monophonic sections can contain everything: bars, crescendo, tempo\dots Just be careful to the scope of the feature, as explained at \ref{sec:scope}.

\me{It's funny.}
\myself{Hm hm. The polyphony is funny. Are you high?}
\begin{meenv}%
Have you ever apply the function \lstinline!length! on a sheet?
\begin{lstlisting}
>> NoteInit
>> sheet1 = [ C:N4 D:N4 E:N4 F:N4 ];
>> length( sheet1 )

ans =

     4

>> sheet2 = [ G:N4 A:N4 B:N4 +C:N4 ];
>> length( sheet2 )

ans =

     4

\end{lstlisting}
Nothing wrong. But:
\begin{lstlisting}
>> length( sheet1 / sheet2 )

ans =

    11

\end{lstlisting}
Where come from the $3$ extra notes?%
\end{meenv}
\myself{Well, \cacofonix uses extra special notes to know where starts a polyphonic section. It's not a big deal: this kind a ghost notes are really rare and it's completely transparent for you. Why would you apply \lstinline!length! on a sheet anyway?}
\begin{meenv}%
No reason. I guess I was boring. But, wait\dots If sometimes notes are added, it's pretty hazardous to use indexation like \lstinline!mysheet(5:25)!. How to get safely an extract of a sheet?%
\end{meenv}
\myself{It's the first time I hear you speak about safety, but, well, get a look at the section \ref{sec:Extraction}.} 

\subsection{Sustain}
\label{sec:Sustain}

For some instruments (piano, essentially) you can manage (press or release) a sustain pedal. Just add the special note \lstinline!Note('Sustain', 'on')! when you want activate the sustain and \lstinline!Note('Sustain', 'off')! when you don't want the sustain anymore.

If a \lstinline!Note('Sustain', 'on')! is added, the \cacofonix function adds automatically a \lstinline!Note('Sustain', 'off')! if no one as been specify before.

Sustain is a feature with a channel scope.

\begin{lilypond}
\new GrandStaff <<
\new Staff { \set Staff.pedalSustainStyle = #'mixed \key fis \minor \clef treble \relative c' { \time 2/4 cis4.\(\sustainOn fis8\) a4.\(\sustainOff\sustainOn fis8\) eis4.\(\sustainOff\sustainOn fis16 gis16\) fis2\sustainOff\sustainOn } }
\new Staff { \key fis \minor \clef bass \relative c, { \time 2/4 fis8( <a cis a'>\arpeggio\staccato) cis,\staccato <cis' a'>\staccato fis,( <a cis a'>\arpeggio\staccato) cis,\staccato <cis' a'>\staccato fis,( <b d b'>\arpeggio\staccato) b,\staccato <d' b'>\staccato fis,( <a cis a'>\arpeggio\staccato) cis,\staccato <cis' a'>\staccato } } >>
\end{lilypond}

\begin{lstlisting}
NoteInit

SusOn = Note( 'Sustain', 'on' );
SusOff = Note( 'Sustain', 'off' );

sheet = [ Note([2 4]) ...
	SusOn Cs:N4' ~Fs:N8 bar ...
	SusOn A:N4' ~Fs:N8 bar ...
	SusOn Es:N4' ~Fs:N16 Gs:N16 bar ...
	SusOn Fs:N2 SusOff bar ...
	] / [ Note('--') ...
	Fs:N8 ~A++Cs++A:'$.':N8 Cs:'.':N8 +Cs++A:'.':N8 bar ...
	Fs:N8 ~A++Cs++A:'$.':N8 Cs:'.':N8 +Cs++A:'.':N8 bar ...
	Fs:N8 ~B++D++Gs:'$.':N8 -B:'.':N8 +D++Gs:'.':N8 bar ...
	Fs:N8 ~A++Cs++A:'$.':N8 Cs:'.':N8 +Cs++A:'.':N8 bar ];

cacofonix( 'HungarianDanceN5', 'Tempo', 100, sheet );
\end{lstlisting}

\subsection{Markers}
\label{sec:Markers}

Makers are useful to organize your sheets. To add a marker labeled \emph{mymarker} in the sheet, add the special note \lstinline!Note('Marker', 'mymarker')! at the right place.

When a marker is read, \cacofonix checks if a previous sheet (or a previous monophonic section) has defined a marker at the same place with the same label. If no marker is found, and no marker has been created after, the new marker is recorder, else an error is thrown.
\me{In brief, all sheets bring markers into line with the first.}

Marker can be used everywhere in the sheet, but it's common to place it at the start of a mesure. If you study carefully the paragraph above, you can deduce that markers are optional, but in the first sheet.

\begin{lilypond}
\new GrandStaff <<
\new Staff { \key c \major \time 4/4 \relative c' { c4^\markup{ A } c g' g a a g2 f4^\markup{ B } f e e d d c2 } }
\new Staff { \key c \major \time 4/4 \clef bass \relative c { c4 <e g> c <e g> f <a c> e <g c> f <a c> e <g c> d <g b> <c, e g>2 } } >>
\end{lilypond}

\begin{lstlisting}
>> NoteInit
>> markA = Note( 'Marker', 'A' );
>> markB = Note( 'Marker', 'B' );
>> sheet1 = [ ...
	markA C:N4 C:N4 G:N4 G:N4 bar ...
	A:N4 A:N4 G:N2 bar ...
	markB F:N4 F:N4 E:N4 E:N4 bar ...
	D:N4 D:N4 C:N2 bar ];
>> sheet2 = [ Note('-') ...
	C:N4 E+G:N4 C:N4 E+G:N4 bar ...
	F:N4 A++C:N4 E:N4 G++C:N4 bar ...
	markB F:N4 A++C:N4 E:N4 G++C:N4 bar ...
	D:N4 G+B:N4 C+E+G:N2 bar ];
>> cacofonix( 'TinkleTinkleLittleStar', 'Tempo', 120, ...
	'Piccolo', sheet1, ...
	'Acoustic Bass', sheet2 );
\end{lstlisting}

Markers are very useful when \cacofonix crashes: the error message gives the problematic measure in function of the last marker read.

\subsubsection{Go to a marker}
\label{sec:Goto}

Sometimes, a sheet contains a long pause of several measures. Of course, you can fill theses measures with rests, but it can be more convenient to use a special note with the meaning ``From now and to this marker, don't play anything''. This kind of note is called a \emph{goto} marker\footnote{The name comes from of the famous instruction of BASIC.} and can be created by two ways: 
\begin{lstlisting}
>> gotomarker = Note( 'Marker*', 'mymarker' );
\end{lstlisting}
or
\begin{lstlisting}
>> mymarker = Note( 'Marker', 'mymarker' );
>> gotomarker = ~mymarker;
\end{lstlisting}

A goto marker is first a marker: it can be use for an extraction (see the next section) and in monophonic sections. Of course, the first sheet given to the \cacofonix function can not use goto makers.

\begin{lilypond}
\new GrandStaff <<
\new Staff { \key c \major \time 4/4 \relative c' { c4^\markup{ A } c g' g a^\markup{ B } a g2 f4^\markup{ C } f e e d^\markup{ D } d c2 } }
\new Staff { \key c \major \time 4/4 \clef bass \relative c { R1*3 r2 <c e g>2 } } >>
\end{lilypond}

\begin{lstlisting}
>> NoteInit
>> markA = Note( 'Marker', 'A' );
>> markB = Note( 'Marker', 'B' );
>> markC = Note( 'Marker', 'C' );
>> markD = Note( 'Marker', 'D' );
>> sheet1 = [ ...
	markA C:N4 C:N4 G:N4 G:N4 bar ...
	markB A:N4 A:N4 G:N2 bar ...
	markC F:N4 F:N4 E:N4 E:N4 bar ...
	markD D:N4 D:N4 C:N2 bar ];
>> sheet2 = [ ~markD Note('-') ...
	R:N2 C+E+G:N2 bar ];
>> cacofonix( 'TinkleTinkleLittleStar', 'Tempo', 120, ...
	'Piccolo', sheet1, ...
	'Acoustic Bass', sheet2 );
\end{lstlisting}

\subsubsection{Extraction \lstinline!|!}
\label{sec:Extraction}

Sometimes, it can be useful to extract a piece of a sheet which has been already transcode (\eg to play something twice, or to add a coda\dots). This operation can be very complicated with polyphonic sections, so the operator \lstinline!or! (\lstinline!|!) realizes neatly this function.

To extract a sheet from the start to a marker labelled \emph{myMarker}, just execute this code:
\begin{lstlisting}
>> finalSheet = sheet|'myMarker';
\end{lstlisting}
or
\begin{lstlisting}
>> myMarker = Note( 'Marker', 'myMarker' );
>> finalSheet = sheet|myMarker;
\end{lstlisting}
Of course, the markers (or goto markers) have to be present in the sheet, in every monophonic parts at the right place.

In the same way, to extract a piece of sheet, from the marker \emph{myMarker} to the end, execute this code:
\begin{lstlisting}
>> finalSheet = 'myMarker'|sheet;
\end{lstlisting}
or
\begin{lstlisting}
>> myMarker = Note( 'Marker', 'myMarker' );
>> finalSheet = myMarker|sheet;
\end{lstlisting}

So, this is how to extract a piece from a marker to an other: \\
\begin{lilypond}
\new GrandStaff <<
\new Staff { \key c \major \time 4/4 \relative c' { a'^\markup{ B } a g2 f4^\markup{ C } f e e } }
\new Staff { \key c \major \time 4/4 \clef bass \relative c { f4 <a c> e <g c> f <a c> e <g c> } } >>
\end{lilypond}

\begin{lstlisting}
>> NoteInit
>> markA = Note( 'Marker', 'A' );
>> markB = Note( 'Marker', 'B' );
>> markC = Note( 'Marker', 'C' );
>> markD = Note( 'Marker', 'D' );
>> sheet1 = [ ...
	markA C:N4 C:N4 G:N4 G:N4 bar ...
	markB A:N4 A:N4 G:N2 bar ...
	markC F:N4 F:N4 E:N4 E:N4 bar ...
	markD D:N4 D:N4 C:N2 bar ];
>> sheet2 = [ Note('-') ...
	markA C:N4 E+G:N4 C:N4 E+G:N4 bar ...
	markB F:N4 A++C:N4 E:N4 G++C:N4 bar ...
	markC F:N4 A++C:N4 E:N4 G++C:N4 bar ...
	markD D:N4 G+B:N4 C+E+G:N2 bar ];
>> sheet = markB | (sheet1/sheet2) | markD;
\end{lstlisting}

\myself{The markers are included in the extracted sheet. If you are using a player which displays the markers in the midi file, you should see it.}
\me{And if it doesn't?}
\myself{Sometimes, you are a really annoying person.}

\subsection{Pitch}
\label{sec:Pitch}

To do a trill or a portamento, you can modify the pitch of the channel with a \lstinline!Note( 'pitch', value )!. The value is a string corresponding to the number of half steps to add (or to subtract) to the notes. The acceptable characters and their effects on the value are listed on the table \ref{tab:pitchValue}.

\begin{table}
	\centering
	\begin{tabular}{cl}
		\lstinline!'#'! & Add a half step \\
		\lstinline!'+'! & Add a quarter step \\
		\lstinline!'0'! & Add nothing (reset) \\
		\lstinline!'-'! & Subtract a quarter step \\
		\lstinline!'b'! & Subtract a half step \\
	\end{tabular}
	\caption{Characters for the pitch value}
	\label{tab:pitchValue}
\end{table}

Two optional parameters can be given. The first is the transition between the \emph{last} pitch value and the new one.

\myself{Be careful! With a transition, you modify \emph{the previous and the next} notes!}

To add a transition, just specify the name of the transition (see the figure \ref{fig:pitchTransitions}) between the string \lstinline!'pitch'! and the new value: \lstinline!Note( 'pitch', transition, value )!.

\begin{figure}
	\begin{center}
		\begin{subfloatenv}{Transition \lstinline!'none'! (default)}
			\begin{asy}
				displayPitchTransition( pitchTransNone );
			\end{asy}
		\end{subfloatenv} %
		\begin{subfloatenv}{Transition \lstinline!'linear'!}
			\begin{asy}
				displayPitchTransition( pitchTransLinear );
			\end{asy}
		\end{subfloatenv}
		\begin{subfloatenv}{Transition \lstinline!'quad'!}
			\begin{asy}
				displayPitchTransition( pitchTransQuad );
			\end{asy}
		\end{subfloatenv}%
		\begin{subfloatenv}{Transition \lstinline!'quad2'!}
			\begin{asy}
				displayPitchTransition( pitchTransQuad2 );
			\end{asy}
		\end{subfloatenv}
	\end{center}
	\caption{Pitch transitions}
	\label{fig:pitchTransitions}
\end{figure}

The second optional argument is the delay: like dynamics, if a delay is given (a number or a duration note), the note will be effective only after this duration. The delay is placed after the value: \lstinline!Note( 'pitch', value, delay )!.

The next example is maybe the most complicated demonstration of this document. The trill (lines 6 to 12) is an array of \emph{pitch} notes, where each \note has alternatively the value \lstinline!'b'! and \lstinline!'#'! and with an increasing delay. In the final midi file, the trill speeds up because of the fermata. The portamento (lines 14 to 16) is simply two \emph{pitch} notes: the first rises the pitch up of 29 half steps, and the second reset the pitch value. As you can see in the sheet, the trill is placed before the modified note whereas the portamento is placed after. \\
\begin{lilypond}
\new Staff { \tempo 4=80 \clef treble \key bes \major \time 4/4 \relative c {
f2\fermata\startTrillSpan\mf ~ f4 f4\stopTrillSpan \glissando
bes''2-> \appoggiatura { aes16[ bes] } \times 2/3 { aes8-. ges-. aes-. } \times 2/3 { ges-. aes-. ges-. }
f8-- ees-- d-- des-- ~ des ees-- e-- f-- ~
f\< d bes32( c bes a) aes8-> ~ aes\> ges f\! f-> ~
f1 } }
\end{lilypond}

\begin{lstlisting}
NoteInit
N24 = Note(1/6);
N32 = Note(1/8);
N48 = Note(1/12);

delay = N8; val = { 'b', '#' };
trill = Note( 'pitch', val{1}, delay);
for t = 1:20
	delay = delay+N32;
	trill = [ trill ...
		Note( 'pitch', 'quad', val{1+mod(t,2)}, delay) ];
end

portamento = [ ...
	Note( 'pitch', 'quad', repmat('#',1,29) ) ...
	Note( 'pitch', '0' ) ];

sheet = [ ...
	Note('fermata', N2, N2') trill -F:N2' ...
		Note( 'pitch', '0' ) -F:N4 portamento bar ...
	+Bf:'>':N2 ~[ +Af:N48 +Bf:N48 +Af:'.':N24 ] ...
		+Gf:'.':N12 +Af:'.':N12 ...
		+Gf:'.':N12 +Af:'.':N12 +Gf:'.':N12 bar ...
	+F:'-':N8 +Ef:'-':N8 +D:'-':N8 +Df:'-':N4 ...
		+Ef:'-':N8 +E:'-':N8 +F:'-':N8 bar ...
	Note('cresc',B,'f') ~+F:N8 +D:N8 ...
		~[Bf:N32 +C:N32 Bf:N32 A:N32] ...
		Note('cresc',B,'mf') Af:'>':N8 ...
		~Af:N8 Gf:N8 F:N8 F:'>':N8 bar ...
	~F:N bar ];

cacofonix( 'RhapsodyInBlue', ...
	'Tempo', 80, ...
	'Clarinet', sheet );
\end{lstlisting}

\subsection{Display}
\label{sec:Display}

The function \lstinline!display! has been overloaded: it can be used to display a sheet or a vector of \note without duration. To do that, just don't add a \lstinline!;! at the end of the \matlab command: \\
\begin{lilypond}
\new Staff { \tempo 4=52 \clef treble \key aes \major \time 2/4 \relative c'' {
c8.\p\(^\markup{ A } ees16 ees4 c8. bes16 aes4\)
bes8.\( c16 ees8. c16 bes2\)
c8.\(^\markup{ B } ees16 ees4 c8. bes16 aes4\)
bes8\( c bes8. aes16 aes2\) } }
\end{lilypond}

\begin{lstlisting}
>> NoteInit
>> markA = Note( 'Marker', 'A' );
>> markB = Note( 'Marker', 'B' );
>> Note.setNbCharByQuater( 16 );
>> sheet = [ Note('+') DynP ...
	markA ~[ C:N8' Ef:N16 Ef:'|':N4 bar ...
	C:N8' -Bf:N16 -Af:N4 ] bar ...
	~[ -Bf:N8' C:N16 Ef:N8' C:N16 bar ...
	-Bf:N2 ] bar ...
	markB ~[ C:N8' Ef:N16 Ef:'|':N4 bar ...
	C:N8' -Bf:N16 -Af:N4 ] bar ...
	~[ -Bf:N8 C:N8 -Bf:N8' -Af:N16 bar ...
	-Af:'|':N2 ] bar ]
$A (1)///////////////////////////$
$p                               $
$|-----C-----~Eb-|------Eb-------$
$1 (2)///////////////////////////$
$                                $
$~-----C-----~Bb-~------Ab-------$
$2 (3)///////////////////////////$
$                                $
$|----Bb-----~-C-~----Eb-----~-C-$
$3 (4)///////////////////////////$
$                                $
$~--------------Bb---------------$
$B (5)///////////////////////////$
$                                $
$|-----C-----~Eb-|------Eb-------$
$1 (6)///////////////////////////$
$                                $
$~-----C-----~Bb-~------Ab-------$
$2 (7)///////////////////////////$
$                                $
$|--Bb---~---C---~----Bb-----~Ab-$
$3 (8)///////////////////////////$
$                                $
$|--------------Ab---------------$
>> cacofonix( 'NewWorldSymphony_Largo', ...
	'Tempo', 52, ...
	'English Horn', sheet );
\end{lstlisting}

The output is pretty intuitive: the display show the name of the notes which are contained in the sheet, with a \lstinline!b! for a flat and a \lstinline!#! for a sharp. The display can show every features of \cacofonix: meters, dynamics, tempo, polyphony\dots Only the octave and the pitch are not displayed. The measures are numbered from the last marker and from the start of the sheet (in brackets). The class function \lstinline!setNbCharByQuater! defines the number of characters per quarter notes.

When the array has no duration, each note contained in the array takes the place of a quarter note:
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 6 );
>> sheet = [ C D Ef Gs ]
$|  C  |  D  | Eb  | G#  $
\end{lstlisting}

For chord, the note's names are simply concatenated:
\begin{lstlisting}
>> sheet = [ C+D Ef+Gs ]
$| CD  |EbG# $
\end{lstlisting}

\begin{myselfenv}%
The display is convenient, but it's not as powerful as the \lstinline!cacofonix! function: it doesn't thrown an error when, for example, a bar is misplaced. Only something weird appears.%
\end{myselfenv}
\begin{meenv}%
And sometimes, something weird appears even if the sheet is correctly build! If the number of characters per quarter is not chosen cleverly, you can have some approximation problems:
\begin{lstlisting}
>> Note.setNbCharByQuater( 18 );
>> sheet = [ Note('+') ...
	~[ C:N8' Ef:N16 Ef:'|':N4 bar ...
	C:N8' -Bf:N16 -Af:N4 ] bar ...
	~[ -Bf:N8' C:N16 Ef:N8' C:N16 bar ...
	-Bf:N2 ] bar ...
	~[ C:N8' Ef:N16 Ef:'|':N4 bar ...
	C:N8' -Bf:N16 -Af:N4 ] bar ...
	~[ -Bf:N8 C:N8 -Bf:N8' -Af:N16 bar ...
	-Af:'|':N2 ] bar ]
$1////////////////////////////////////$
$|------C------~-Eb-|-------Eb--------$
$2////////////////////////////////////$
$~------C------~-Bb-~-------Ab--------$
$3/////////////////////////////////////$
$|-----Bb------~-C--~-----Eb------~-C--$
$4///////////////////////////////////$
$~----------------Bb-----------------$
$5////////////////////////////////////$
$|------C------~-Eb-|-------Eb--------$
$6////////////////////////////////////$
$~------C------~-Bb-~-------Ab--------$
$7////////////////////////////////////$
$|---Bb---~---C----~-----Bb------~-Ab-$
$8///////////////////////////////////$
$|----------------Ab-----------------$
\end{lstlisting}
\end{meenv}

\subsection{Transpose \lstinline!\^!}
\label{sec:Transpose}

We can transpose a \note or a sheet with the operator \lstinline!mpower! (\lstinline!^!). Two ways are possible. The first is use \lstinline!^! with the number of half steps to transpose.
For example, we have the scale of B flat major:
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 6 )
>> scale = [ -Bf C D Ef F G A ]
$|  Bb  |  C   |  D   |  Eb  |  F   |  G   |  A   $
\end{lstlisting}
And we want transpose this scale in G major. To do that, each note have to be reduced of $3$ half steps (or raised of $9$ half steps). Remember the scale steps (see figure \ref{fig:scalesteps})!
\begin{figure}
	\begin{center}
	\begin{asy}
		size( 4cm );
		import labelpath;

		pen circlepen = black;
		pen degpen = black;
		pen notepen = blue;
		pen steppen = red;

		path c = reverse( rotate(90)*unitcircle );
		int clen = length( c );

		draw( c, circlepen );

		real getPos( real h ){ return clen*h/12; }
		pair getPair( real h ){ return point( c, getPos(h) ); }
		path getSub( real a, real b ){ return subpath( c, getPos(a), getPos(b) ); }

		void addDeg( real pos, string deg, string note ){
			dot( getPair( pos ), degpen );
			label( deg, getPair( pos ), getPair( pos ), degpen );
			label( note, getPair( pos ), getPair( pos+6 ), notepen );
		}

		void addStep( real a, real b, string step ){
			labelpath( shift(0,1)*Label(step), getSub( a, b ), steppen );
		}

		addDeg( 0, "I", "C" );
		addDeg( 2, "II", "D" );
		addDeg( 4, "III", "E" );
		addDeg( 5, "IV", "F" );
		addDeg( 7, "V", "G" );
		addDeg( 9, "VI", "A" );
		addDeg( 11, "VII", "B" );

		addStep(  0,  2, "2" );
		addStep(  2,  4, "2" );
		addStep(  4,  5, "1" );
		addStep(  5,  7, "2" );
		addStep(  7,  9, "2" );
		addStep(  9, 11, "2" );
		addStep( 11, 12, "1" );
	\end{asy}
	\end{center}
	\caption[The scale steps]{The scale steps apply to the C major scale: the degree in black, the number of half step in red and the corresponding name of the note in blue.}
	\label{fig:scalesteps}
\end{figure}

\begin{lstlisting}
>> scale^-3
$|  G   |  A   |  B   |  C   |  D   |  E   |  F#  $
>> scale^9
$|  G   |  A   |  B   |  C   |  D   |  E   |  F#  $
\end{lstlisting}
The second solution is one octave higher than the first.

When \lstinline!^! is used only with a double, \cacofonix searches basically the name the most likely. So, in our example, raise \lstinline!scale! of $3$ half steps will make the scale of D flat major (five flats at the key), not the scale of C sharp major (seven sharps at the key):
\begin{lstlisting}
>> scale^3
$|  Db  |  Eb  |  F   |  Gb  |  Ab  |  Bb  |  C   $
\end{lstlisting}
To obtain the scale of C sharp major, you have to use \lstinline!^! with a small vector of two elements: one for number the degree and one for the number of half steps from the new degree. In our case, B flat major to C sharp major, you have to raise of one degree and one half step:
\begin{lstlisting}
>> scale^[1 1]
$|  C#  |  D#  |  E#  |  F#  |  G#  |  A#  |  B#  $
\end{lstlisting}
Of course, the number of degree and the number of half step are algebraic: they can be positive or negative. This is some examples, funny or not:
\begin{lstlisting}
>> scale^[0 0]
$|  Bb  |  C   |  D   |  Eb  |  F   |  G   |  A   $
>> scale^[-2 0]
$|  G   |  A   |  B   |  C   |  D   |  E   |  F#  $
>> scale^[9 -1]
$|  Db  |  Eb  |  F   |  Gb  |  Ab  |  Bb  |  C   $
>> scale^[0 -2]
$| B3b  | Cbb  | Dbb  | E3b  | Fbb  | Gbb  | Abb  $
\end{lstlisting}

\me{Why a transposition operator? It's really useful?}
\myself{Sometimes, you have the sheets directly transposed for an instrument, a clarinet in B flat for example. With this operator, you can transcode your sheet as it's written in your paper version and get the \emph{real} notes in one command line. But, and that's why \cacofonix kicks ass, the operator is in fact essentially used on void notes to create \emph{virtual} chords. You can see examples in \noteInitFile, but we will explain that latter more clearly.}

\subsection{Repeat / Riff \lstinline!.*!}
\label{sec:RepeatRiff}

The operator \lstinline!times! (\lstinline!.*!) was the first attempt to apply tonalities to a rhythmic (riff).

The first usage of this operator is repeat a sheet: when you use it on a sheet and on a number, you create a new sheet repeating the original. The number can be on the left or on the right of the operator:
\begin{lstlisting}
>> Note.setNbCharByQuater(8)
>> 2.*[C:N2 G:N2 bar].*3
$1///////////////////////////////$
$|-------C-------|-------G-------$
$2///////////////////////////////$
$|-------C-------|-------G-------$
$3///////////////////////////////$
$|-------C-------|-------G-------$
$4///////////////////////////////$
$|-------C-------|-------G-------$
$5///////////////////////////////$
$|-------C-------|-------G-------$
$6///////////////////////////////$
$|-------C-------|-------G-------$
\end{lstlisting}

When you use \lstinline!.*! on two sheets, the algorithm is a little more complicated:
\begin{algo}{T}{Operator \lstinline!.*!}{Given two arrays \lstinline!A! and \lstinline!B!, we compute \lstinline!C = A.*B! with this algorithm:}
	\step{Initialize.}{Initialize \lstinline!C = Note.empty()!. Set \lstinline!i = 1! and \lstinline!j = 1!.}
	\step[checki]{Check \lstinline!i!.}{If \lstinline!i > length(A)!, stop the algortihm and return \lstinline!C!.}
	\step[addAi]{Add \lstinline!A(i)!.}{If the \lstinline!i!th element of \lstinline!A! is not a playable note (neither a duration nor a tonality, so a bar, a crescendo\dots) add this element at the end of \lstinline!C!: \lstinline!C(end+1)=A(i)! and go to step \stepref{inci}.}
	\step[checkj]{Check \lstinline!j!.}{If \lstinline!j > length(B)!, set \lstinline!j = 1! and go to the step \stepref{inci}.}
	\step[addBj]{Add \lstinline!B(j)!.}{If the \lstinline!j!th element of \lstinline!B! is not a playable note (see step \stepref{addAi}), add this element at the end of \lstinline!C! and go to \stepref{incj}.}
	\step[addAiBj]{Add \lstinline!A(i):B(j)!.}{Merge and add the new note: \lstinline!C(end+1) = A(i):B(j)!.}
	\step[incj]{Increase \lstinline!j!.}{Set \lstinline!j = j + 1!. Go to \stepref{checkj}.}
	\step[inci]{Increase \lstinline!i!.}{Set \lstinline!i = i + 1!. Go to \stepref{checki}.}
\end{algo}

The algorithm isn't as complicated as it seems. In fact, the steps \stepref[T]{checki} and \stepref[T]{inci} and the steps \stepref[T]{checkj} and \stepref[T]{incj} define two imbricated \lstinline!for! loops: each note of \lstinline!A! is merged with each note of \lstinline!B! (step \stepref[T]{addAiBj}), unless a note can't be merged (steps \stepref[T]{addAi} and \stepref[T]{addBj}). This is a pseudo \matlab code of this algorithm:
\begin{lstlisting}
function C = times( A, B )
	C = Note.empty();

	for i = 1:length( A )
		if ~A(i).isNote
			C(end+1) = A(i);

		else
			for j = 1:length( B )
				if ~B(j).isNote
					C(end+1) = B(j);

				else
					C(end+1) = A(i):B(j);

				end
			end
		end
	end
end
\end{lstlisting}

So, why it's so useful? Well, the most often, one of the arrays is reduced to one \note, so this note is apply on each note of an array: pretty interesting when you have a succession of notes which have the same duration, or the same tonality. This is an example:

\begin{lilypond}
\new GrandStaff <<
\new Staff { \key f \major \time 4/4 \relative c' { R1*2 bes2. ~ bes8 g8-> R1 bes1 <g g'>8->\( dis'8\) r4 r2 } }
\new Staff { \key f \major \time 4/4 \clef bass \relative c, {
c8 c d( c) dis( c) f( e)
c8 c d( c) dis( c) f( e)
c8 c d( c) dis( c) f( e)
c8 c d( c) dis( c) f( e)
c8 c d( c) dis( c) f( e)
c8 c d( c) dis( c) f( e)
} } >>
\end{lilypond}

\begin{lstlisting}
NoteInit

TROMBONE = [ [ R:N bar ].*2 ...
	-Bf:N2' ~-Bf:N8 -G:'>':N8 bar ...
	R:N bar ...
	-Bf:N bar ...
	-G+G:'>':N8 Ds:N8 R:N4 R:N2 bar ];

BASS = [ Note('--') 6.*[ C C D ~C Ds ~C F ~E bar ].*N8 ];

cacofonix( 'PeterGunn', 'Tempo', 120, ...
	'Trombone', TROMBONE, ...
	'Acoustic Bass', BASS );	
\end{lstlisting}

\me{This explanation needs two remarks.}
\myself{We share. You take one, and I get the second.}
\me{Never. If you want to do something, search examples for my speech.}
\myself{I would like to kill you. So much.}
\me{Excellent. So, the first point is: a rest is a tonality note, so you can't have a rest in the riff -- since it will be associate with a \note of the other array. That's the huge limitation of that operator. Have you found an example?}
\myself{Do you really expect a \matlab code with this operator to prove that something isn't possible to do with that operator precisely? Sorry, I need a little more time\dots}
\me{Too bad. Be focus on the next. And search harder, please. The other point: when you want to set an attack, you can use a rest with the operator \lstinline!:!. Examples: \dots}
\begin{myselfenv}
	Hum\dots Well, I have one setting the accent on duration notes:

\begin{lilypond}
	\new DrumStaff \with{
	drumStyleTable = #percussion-style
	\override StaffSymbol #'line-count = #1 } {
	\override Staff.BarLine #'bar-extent = #'(-2 . 2)
	\drummode { \time 3/4 sn8-> \times 2/3 { sn16 sn sn } sn8-> \times 2/3 { sn16 sn sn } sn8-> sn sn-> \times 2/3 { sn16 sn sn } sn8-> \times 2/3 { sn16 sn sn } \times 2/3 { sn16 sn sn } \times 2/3 { sn16 sn sn } } }
\end{lilypond}

\begin{lstlisting}
NoteInit

T = Note(1/6).*3;
sheet = [ Note([3 4]) V.*[ ...
	R:'>':N8 T R:'>':N8 T R:'>':N8 N8 bar ...
	R:'>':N8 T R:'>':N8 T T T bar ] ];

cacofonix( 'Bolero', 'Tempo', 72, ...
	'Acoustic Snare', 179.*sheet );
\end{lstlisting}

	And I have another one, where the accents are setted on the tonality notes:

\begin{lilypond}
\new GrandStaff <<
\new Staff { \key a \major \time 4/4 \relative c' { <a cis fis>8 r r <b dis gis> r2 <cis e a>8 r r <b dis gis> r2 } }
\new Staff { \key a \major \time 4/4 \clef bass \relative c, {
fis8-> cis e fis-> e cis b cis
fis8-> cis e fis-> e cis b cis
} } >>
\end{lilypond}

\begin{lstlisting}
NoteInit

SYNTH = [ Note([4 4]) ...
	[ -A+Cs+Fs R R -B+Ds+Gs ].*N8 R:N2 bar ...
	[ Cs+E+A R R -B+Ds+Gs ].*N8 R:N2 bar ];

BASS = [ Note('--') ...
	2.*[ Fs:'>':R Cs E Fs:'>':R E Cs -B Cs bar ].*N8 ];

cacofonix( 'BillieJean', 'Tempo', 115, ...
	'Electric Grand Piano', SYNTH, ...
	'Acoustic Bass', BASS );
\end{lstlisting}
\end{myselfenv}
\me{Good boy.}
\myself{Please. Yours explanations are laconic and my demos are awesome. You're nothing without me.}

\subsection{The void note}
\label{sec:VoidNote}

\me{Before start a description of that monster, a little mood music.}

\vspace{ 0.25in }

\begin{center}
\begin{lilypond}
\paper { line-width = 106\mm }
\layout { indent = 2.0\cm }
\header{
	title = "Symphony No. 5"
	composer = "Beethoven"
}
\score { <<
\new Staff { 
	\set Staff.instrumentName = \markup \center-column { Violin, \line { Clarinet } }
	\clef treble \key es \major \time 2/4 \relative c'' {r8 g\ff[ g g] es2\fermata r8 f[ f f] d2 ~ d2\fermata}
}
\new Staff {
	\set Staff.instrumentName = \markup \center-column { Viol, \line { Cello, } \line { \concat{ Bass } } }
	\clef bass \key es \major \partcombine { \relative c' { r8 g[ g g] es2\fermata r8 f[ f f] d2 ~ d2\fermata } } { \relative c { r8 g[ g g] es2 r8 f[ f f] d2 ~ d2 } }
}
>> }
\end{lilypond}
\end{center}

\vspace{ 0.25in }

\myself{And, as recommended by \emph{The Hitchhiker's Guide to the Galaxy}, \textsc{don't panic}. \rightthumbsup}

A void note is a tonality \note, but without defined tonality yet. You can do anything with a void note, like a tonality note: create a chord (you can have only one void note per chord), set a duration, set accents, transpose\dots but the \lstinline!cacofonix! function doesn't accept void notes in sheets: you have to affect a tonality to the void notes before the call of \lstinline!cacofonix! -- except for percussion sheets, where \emph{real} tonality \note are not accepted. To set a final tonality to a void note, you have to use the operator \lstinline!*!.

\subsubsection{Expand \lstinline!*!}
\label{sec:Expand}

First of all, the operator \lstinline!mtimes! (\lstinline!*!) works exactly like the operator \lstinline!.*! when it is used on a sheet and a number: the sheet is simply repeated.
\begin{lstlisting}
>> Note.setNbCharByQuater(8)
>> 3*[ (G:N2)*2 bar ]
$1///////////////////////////////$
$|-------G-------|-------G-------$
$2///////////////////////////////$
$|-------G-------|-------G-------$
$3///////////////////////////////$
$|-------G-------|-------G-------$
\end{lstlisting}

But the real purpose of this operator is set the tonality of a void note. The general algorithm is:
\begin{algo}{M}{Operator \lstinline!*!}{Given a \note \lstinline!n! and a sheet \lstinline!A! (which contains void notes), we compute \lstinline!B = n*A! with this algorithm:}
	\step{Initialize.}{Initialize \lstinline!B = A!. Set \lstinline!i = 1!.}
	\step[checki]{Check \lstinline!i!.}{If \lstinline!i > length(A)!, stop the algorithm and return \lstinline!B!.}
	\step{Set the tonality.}{If the \lstinline!i!th element of \lstinline!A! is a void note, set the tonality of \lstinline!B(i)! with the tonality of \lstinline!n!.}
	\step{Increase \lstinline!i!.}{Set \lstinline!i = i + 1!. Go to \stepref{checki}.}
\end{algo}

The algorithm is much simpler than the operator \lstinline!.*!: it's just a for loop and every note of \lstinline!A! get the tonality of \lstinline!n!. For the fun, this is a pseudo \matlab code:
\begin{lstlisting}
function C = mtimes( n, A )
	ton = n.getTonality();
	B = A;

	for i = 1:length( A )
		if A(i).isVoid
			B(i).setTonality( ton );

		end
	end
end
\end{lstlisting}

\me{And what about the half-void notes? You can create a chord with a real note and a void note, what appens when you set the tonality of the void note?}
\begin{myselfenv}
Well, do the experiment!
\begin{lstlisting}
>> NoteInit
>> mychord = [ C E V ]:N4
$|-----------V-----------$
>> G*mychord
$|----------GCE----------$
\end{lstlisting}
As you can see, the tonalities of the real notes are stored and the new tonality is added. Before that, the display show a \lstinline!V! when the chord is not completly defined. Anyway, create a chord with a void note and real notes is not a common utilisation.
\end{myselfenv}
\me{So, what is the common utilisation?}
\myself{Well, the operator is not so useful without the operator \lstinline!-!. Wait a little.}

\paragraph{Transposed void notes}
\label{sec:VirtualArrays}

A void note can be transposed: the transpositions are applied after the affectation of the tonality. With that behavior, you can create virtual arrays waiting a reference note. For example, how construct quickly different major scales?
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 6 )
>> majorScale = [ V^[0 0] V^[1 0] V^[2 0] V^[3 0] ...
	V^[4 0] V^[5 0] V^[6 0] ];
>> C*majorScale               
$|  C  |  D  |  E  |  F  |  G  |  A  |  B  $
>> Ef*majorScale
$| Eb  |  F  |  G  | Ab  | Bb  |  C  |  D  $
\end{lstlisting}
You can also combine transpositions to get relative minor scales:
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 6 )
>> minorScale = [ V^[0 0] V^[1 0] V^[2 -1] V^[3 0] ...
	V^[4 0] V^[5 -1] V^[6 0] ]; 
>> A*minorScale                                                               
$|  A  |  B  |  C  |  D  |  E  |  F  | G#  $
>> relativeMinorScale = ( V^[-2 0] )*minorScale;
>> C*relativeMinorScale
$|  A  |  B  |  C  |  D  |  E  |  F  | G#  $
>> Ef*relativeMinorScale
$|  C  |  D  | Eb  |  F  |  G  | Ab  |  B  $
\end{lstlisting}

Theses examples are very theorical, but the creation of virtual chords is a direct application of that feature.
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 6 )
>> ChordMajor = [ V^[0 0] V^[2 0] V^[4 0] ];
>> ChordMinor = [ V^[0 0] V^[2 -1] V^[4 0] ];
>> G*ChordMajor
$|  G  |  B  |  D  $
>> F*ChordMinor 
$|  F  | Ab  |  C  $
\end{lstlisting}
The files \noteInitFile and \noteInitFrFile contain the common chords and can be excessively used in sheets for piano, guitar, bass\dots Good demonstrations of how use that need the explanation of the operator \lstinline!-! and are grouped at the section \ref{sec:voidExamples}.

\subsubsection{Index \lstinline!-!}
\label{sec:Index}

In fact, the operator \lstinline!*! can be used with two arrays: one with only tonality notes (instead only one tonality note as explain at \ref{sec:Expand}) and a array of \note, which contains some void notes. Per default, if you are using the operator on two arrays: \lstinline!A*B!, all void notes of \lstinline!B! will get the tonality of the first note of \lstinline!A!. So, you can't get the tonalities of the other notes of \lstinline!A!, unless you use the operator \lstinline!-!.

The operator \lstinline!-! define an index on a void note: in the example \lstinline!A*B!, a note \lstinline!V-3! in \lstinline!B! means simply the third note of \lstinline!A!. As we can guess, a void note has per default the index \lstinline!1!. The index \lstinline!0! is special: \lstinline!V-0! creates a chord with all the tonality notes of \lstinline!A!. If the index is greater than the length of the tonality array (\lstinline!A!), the note is deleted without any warning:
\begin{lstlisting}
>> NoteInit
>> Note.setNbCharByQuater( 8 )
>> [ C E G ]*[ V-1 V-2 V-3 V-4 ].*N8
$|-C-|-E-|-G-$
\end{lstlisting}

\subsubsection{Examples}
\label{sec:voidExamples}

The two following examples show how use the void notes. The first use the void note with the index \lstinline!0!. It is a demonstration of how use the virtual chords seen at the section \ref{sec:VirtualArrays}.

\begin{lilypond}
	\score{ <<
	\chords{ g1 c s d2 e1 }
	\relative c' { \time 4/4 r4 e4 d8 c8 b4 b4 c8 b8 ~ b8 a8 g8 a8 b4 c8 b8 ~ b8 a8 g8 a8 \time 2/4 b4 c4 \time 4/4 b1 }
	\addlyrics { My ba -- by don't mess a -- round be -- cause she loves me so and this I know for sho'. }
	>> }
\end{lilypond}

\begin{lstlisting}
NoteInit

M44 = Note([4 4]);
M24 = Note([2 4]);

MELODY = [ Note('-') M44 ...
	R:N4 +E:N4 +D:N8 +C:N8 B:N4 bar ...
	B:N4 +C:N8 B:[N8 N8] A:N8 G:N8 A:N8 bar ...
	B:N4 +C:N8 B:[N8 N8] A:N8 G:N8 A:N8 bar ...
	M24 B:N4 +C:N4 bar ...
	M44 B:N bar ];

V0 = V-0; RIFF = [ V0:N4 V0:N8 V0:N4 (V0:N8)*3 bar ];
GUITAR = [ DynMP ...
	G*CM*RIFF ...
	C*CM*RIFF ...
	C*CM*RIFF ...
	D*CM*[ V0:N4 V0:N8 V0:N8 bar ] ...
	E*CM*RIFF ];

cacofonix( 'HeyYa', 'Tempo', 160, ...
	'Oboe', MELODY, ...
	'Nylon-String Guitar', GUITAR );
\end{lstlisting}

The second example is a little more complicated: the chords are arpeggiated and one note is raised to the upper octave with the unary operator \lstinline!+!. For the strings, you can see the use of the operator \lstinline!:! directly on the arrays of tonality notes. Of course, the use of a riff \lstinline!V-0:N2! should be possible.

\begin{lilypond}
	\score{ <<
	\chords{ s4 f2 a:m bes a:m g:m f a d:m }
	\relative c' { \key f \major \partial 4 c8 e f4. a8 c2 r8 d d d c2 r8 bes bes bes a2 r8 g g g f2 }
	\addlyrics { I see trees of green, red ros -- es too, I see them bloom, for me and you. }
	>> }
\end{lilypond}

\begin{lstlisting}
NoteInit

VOICE = [ Note('-') C:N8 E:N8 bar ...
	F:N4' A:N8 +C:N2 bar ...
	R:N8 (+D:N8)*3 +C:N2 bar ...
	R:N8 (Bf:N8)*3 A:N2 bar ...
	R:N8 (G:N8)*3 F:N2 bar ];

RIFF = [ V-1 V-2 V-3 +V-1 +V-4 V-6 V-5 V-4 bar ].*N8;
GUITAR = [ Note('-') R:N4 bar ...
	[ F*CM  A*Cm ]*RIFF ...
	[ Bf*CM A*Cm ]*RIFF ...
	[ G*Cm  F*CM ]*RIFF ...
	[ A*CM  D*Cm ]*RIFF ];

VIOLIN = [ DynPP R:N4 bar ...
	F*CM:N2 A*Cm:N2 bar ...
	Bf*CM:N2 A*Cm:N2 bar ...
	G*Cm:N2 F*CM:N2 bar ...
	A*CM:N2 D*Cm:N2 bar ];

cacofonix( 'WhatAWonderfulWorld', 'Tempo', 80, ...
	'Bassoon', VOICE, ...
	'Nylon-String Guitar', GUITAR, ...
	'Slow String Ensemble', VIOLIN );
\end{lstlisting}

\subsection{Function \lstinline!cacofonix!}
\label{sec:CacofonixFunction}

So, it remains one big last question is: how get the midi files from the sheets. Of course, that's the purpose of the function \lstinline!cacofonix!. You have already seen a lot of example of the utilisation of this function, but some features are not explained yet.

The API of \lstinline!cacofonix! to write a midi file can be write like that:
\begin{lstlisting}
cacofonix( midiFilePath, ...
	[ 'Tempo', tempo, ] ...
	[ 'Velocity', velocity, ] ...
	[ 'DrumKit', drumkit, ] ...
	[ mainSheet, ] ...
	[ pianoSheet1, pianoSheet2, ... ] ...
	[ instrument1, sheet1, sheet2, ... ] ...
	[ instrument2, ... ] ... )
\end{lstlisting}
\begin{itemize}
	\item The parameter \lstinline!midiFilePath! is the path to midi file. It is automatically completed by the extension \lstinline!'.mid'!.
	\item The optional parameter \lstinline!tempo! following the string \lstinline!'Tempo'! define the general tempo. See the section \ref{sec:Tempo} for more informations.
	\item The optional parameter \lstinline!velocity! following the string \lstinline!'Velocity'! define the velocities to apply to the dynamics. See the section \ref{sec:Velocity} for more informations.
	\item The optional parameter \lstinline!drumkit! following the string \lstinline!'DrumKit'! define the drum kit to use. Use it at your own risk.
		\myself{What? That's all you have to tell about the drum kits? ``Use it at you own risk''?}
		\me{Well, if you want more clues, you can see the appendix \ref{sec:AvailDrumKits}.}
	\item The parameter \lstinline!mainSheet! is an optional sheet without any playable note: it's the perfect place to define meters, tempos, fermatas and markers when the project contains several instruments.
	\item The meaning of the next parameters is strongly related to the explanations of the section \ref{sec:SITandC}. The first sheets with playable notes (but without being preceded by the name of an instrument) are associated with an unique channel with the timbre of a piano. When a string containing the name of an instrument or a percussion is given, \lstinline!cacofonix! creates a new channel (with right timbre) and associates the next sheets to that instrument.
\end{itemize}

The names of the instruments and percussions can be found in the sections \ref{sec:AvailInstruments} and \ref{sec:AvailPercussion}. \lstinline!cacofonix! can manage the instruments of the midi specification level 1 and 2, but not necessarily your midi player: the level 2 is not always supported. You have been warned. 

\begin{meenv}%
	Why in the appendix \ref{sec:AvailPercussion}, there are columns \lstinline!V-2! and \lstinline!V-3!?%
\end{meenv}
\begin{myselfenv}%
	As you have to know, a sheet of an instrument can't contain a void note and a sheet of a percussion has to contain only void notes. But, moreover, for some percussions, the indexed void notes \lstinline!V-2! and \lstinline!V-3! have special meanings and can be used to play an other (but very related) percussion.%
\end{myselfenv}

\paragraph{}

We will finish that guide by a last demonstration with percussions:

\begin{lilypond}
	\score{ <<
	\relative c'' { \key g \major \time 4/4 d16 e e d e8 e16 d e8 e d16 e e d e8 e16 d e d e8 a g g16 d e8 e16 e8 d16 e8 r16 e, e'8 e e r d16 d d8 d8 a16( b) a g e e ~ e8 b'16 d g4 fis e d e8 e r4 r2 }
	\addlyrics { Bud -- dy, you're a boy, make a big noise play -- in' in the street. Gon -- na be a big man some -- day. You got mud on yo' face, you big dis -- grace, kick -- in' your can all o -- ver the place, sing -- in' WE WILL, WE WILL ROCK YOU! }
	>> }
\end{lilypond}

\begin{lstlisting}
NoteInit

MVerse = Note( 'Marker', 'Verse' );
MChorus = Note( 'Marker', 'Chorus' );

P = [ R:N bar ]a
MAIN = [ Note([4 4]) Note( 'Tempo', 80 ) ...
	P*2 MVerse P*4 MChorus P*2 ];

VOICE = [ Note('+') ~MVerse ...
	D:N16 E:N16 E:N16 D:N16 E:N8 E:N16 D:N16 ...
		E:N8 E:N8 D:N16 E:N16 E:N16 D:N16 bar ...
	E:N8 E:N16 D:N16 E:N16 D:N16 E:N8 ...
		A:N8 G:N8 G:N16 D:N16 E:N8 bar ...
	E:N8 E:N16 D:N16 E:N8 R:N16 -A:N16 ...
		E:N8 E:N8 E:N8 R:N8 bar ...
	D:N16 D:N16 D:N8 D:N8 -A:N16 ~-B:N16 ...
		-A:N16 -G:N16 -E:N16 -E:N8' -B:N16 D:N16 bar ...
	MChorus G:N4 Fs:N4 E:N4 D:N4 bar ...
	E:N8 E:N8 R:N2' bar ];

BASS = [ V:N8 V:N8 R:N4     V:N8 V:N8 R:N4     bar ]*8;
CLAP = [ R:N8 R:N8 V:'>':N4 R:N8 R:N8 V:'>':N4 bar ]*8;

cacofonix( 'WeWillRockYou', MAIN, ...
	'Soprano Sax', VOICE, ...
	'Acoustic Bass Drum', BASS, ...
	'Hand Clap', CLAP );
\end{lstlisting}

\paragraph{}

That's conclude this document. We hope you will enjoy \cacofonix as much as I had while I was writing it. Happy \cacofonix-ing!

\me{See you!}
\myself{Good bye!}

\appendix

\section{Listings}

\subsection{Name of the available instruments}
\label{sec:AvailInstruments}

The names of the available instruments are listed here. The instruments \lstinline!'Piano'! and \lstinline!'Acoustic Grand Piano'! are the same instrument. A star (\lvlt) before a name means that instrument is only defined in the midi specification level 2: if the midi player is a little old and doesn't know that instrument (or the sound bank doesn't define this instrument), it is replace by the first previous instrument without a star. The function \lstinline!cacofonix! can produce this list with:
\begin{lstlisting}
>> cacofonix -instruments % only level 1
>> cacofonix -instruments -level2 % levels 1 and 2
\end{lstlisting}

\begin{center}
\begin{longtable}{ll|ll}
\instrusection{Piano}
 \lvlo & \lstinline!'Piano'! & \lvlt & \lstinline!'60s Electric Piano'! \\
 \lvlo & \lstinline!'Acoustic Grand Piano'! & \lvlo & \lstinline!'Chorused Electric Piano'! \\
 \lvlt & \lstinline!'Wide Acoustic Grand Piano'! & \lvlt & \lstinline!'Detuned Electric Piano 2'! \\
 \lvlt & \lstinline!'Dark Acoustic Grand Piano'! & \lvlt & \lstinline!'Electric Piano 2 Variation'! \\
 \lvlo & \lstinline!'Bright Acoustic Piano'! & \lvlt & \lstinline!'Electric Piano Legend'! \\
 \lvlt & \lstinline!'Wide Bright Acoustic Piano'! & \lvlt & \lstinline!'Electric Piano Phase'! \\
 \lvlo & \lstinline!'Electric Grand Piano'! & \lvlo & \lstinline!'Harpsichord'! \\
 \lvlt & \lstinline!'Wide Electric Grand Pinao'! & \lvlt & \lstinline!'Coupled Harpsichord'! \\
 \lvlo & \lstinline!'Honky-tonk Piano'! & \lvlt & \lstinline!'Wide Harpsichord'! \\
 \lvlt & \lstinline!'Wide Honky-tonk Piano'! & \lvlt & \lstinline!'Open Harpsichord'! \\
 \lvlo & \lstinline!'Rhodes Piano'! & \lvlo & \lstinline!'Clavinet'! \\
 \lvlt & \lstinline!'Detuned Electric Piano 1'! & \lvlt & \lstinline!'Pulse Clavinet'! \\
 \lvlt & \lstinline!'Electric Piano 1 Variation'! \\
\instrusection{Chromatic Percussion}
 \lvlo & \lstinline!'Celesta'! & \lvlt & \lstinline!'Wide Marimba'! \\
 \lvlo & \lstinline!'Glockenspiel'! & \lvlo & \lstinline!'Xylophone'! \\
 \lvlo & \lstinline!'Music Box'! & \lvlo & \lstinline!'Tubular Bell'! \\
 \lvlo & \lstinline!'Vibraphone'! & \lvlt & \lstinline!'Church Bell'! \\
 \lvlt & \lstinline!'Wet Vibraphone'! & \lvlo & \lstinline!'Carillon'! \\
 \lvlo & \lstinline!'Marimba'! & \lvlo & \lstinline!'Santur'! \\
\instrusection{Organ}
 \lvlo & \lstinline!'Hammond Organ'! & \lvlt & \lstinline!'Church Organ 2'! \\
 \lvlt & \lstinline!'Detuned Organ'! & \lvlt & \lstinline!'Church Organ 3'! \\
 \lvlt & \lstinline!'60s Organ'! & \lvlo & \lstinline!'Reed Organ'! \\
 \lvlt & \lstinline!'Organ 4'! & \lvlt & \lstinline!'Puff Organ'! \\
 \lvlo & \lstinline!'Percussive Organ'! & \lvlo & \lstinline!'French Accordion'! \\
 \lvlt & \lstinline!'Detuned Organ 2'! & \lvlt & \lstinline!'Italian Accordion'! \\
 \lvlt & \lstinline!'Organ 5'! & \lvlo & \lstinline!'Harmonica'! \\
 \lvlo & \lstinline!'Rock Organ'! & \lvlo & \lstinline!'Bandoneon'! \\
 \lvlo & \lstinline!'Church Organ 1'! \\
\instrusection{Guitar}
 \lvlo & \lstinline!'Nylon-String Guitar'! & \lvlt & \lstinline!'Mid Tone Guitar'! \\
 \lvlt & \lstinline!'Ukulele'! & \lvlo & \lstinline!'Muted Electric Guitar'! \\
 \lvlt & \lstinline!'Open Nylon Guitar'! & \lvlt & \lstinline!'Funk Guitar'! \\
 \lvlt & \lstinline!'Nylon Guitar 2'! & \lvlt & \lstinline!'Funk Guitar 2'! \\
 \lvlo & \lstinline!'Steel-String Guitar'! & \lvlt & \lstinline!'Jazz Man'! \\
 \lvlt & \lstinline!'12-String Guitar'! & \lvlo & \lstinline!'Overdriven Guitar'! \\
 \lvlt & \lstinline!'Mandolin'! & \lvlt & \lstinline!'Guitar Pinch'! \\
 \lvlt & \lstinline!'Steel + Body'! & \lvlo & \lstinline!'Distortion Guitar'! \\
 \lvlo & \lstinline!'Jazz Guitar'! & \lvlt & \lstinline!'Feedback Guitar'! \\
 \lvlt & \lstinline!'Hawaiian Guitar'! & \lvlt & \lstinline!'Distortion Rtm Guitar'! \\
 \lvlo & \lstinline!'Clean Electric Guitar'! & \lvlo & \lstinline!'Guitar Harmonics'! \\
 \lvlt & \lstinline!'Chorus Guitar'! & \lvlt & \lstinline!'Guitar Feedback'! \\
\instrusection{Bass}
 \lvlo & \lstinline!'Acoustic Bass'! & \lvlt & \lstinline!'Synth Bass 101'! \\
 \lvlo & \lstinline!'Fingered Bass'! & \lvlt & \lstinline!'Synth Bass 3'! \\
 \lvlt & \lstinline!'Finger Slap'! & \lvlt & \lstinline!'Clavi Bass'! \\
 \lvlo & \lstinline!'Picked Bass'! & \lvlt & \lstinline!'Hammer'! \\
 \lvlo & \lstinline!'Fretless Bass'! & \lvlo & \lstinline!'Synth Bass 2'! \\
 \lvlo & \lstinline!'Slap Bass 1'! & \lvlt & \lstinline!'Synth Bass 4'! \\
 \lvlo & \lstinline!'Slap Bass 2'! & \lvlt & \lstinline!'Rubber Bass'! \\
 \lvlo & \lstinline!'Synth Bass 1'! & \lvlt & \lstinline!'Attack Pulse'! \\
\instrusection{Orchestra Solo}
 \lvlo & \lstinline!'Violin'! & \lvlo & \lstinline!'Tremolo Strings'! \\
 \lvlt & \lstinline!'Slow Violin'! & \lvlo & \lstinline!'Pizzicato Strings'! \\
 \lvlo & \lstinline!'Viola'! & \lvlo & \lstinline!'Harp'! \\
 \lvlo & \lstinline!'Cello'! & \lvlt & \lstinline!'Yang Qin'! \\
 \lvlo & \lstinline!'Contrabass'! & \lvlo & \lstinline!'Timpani'! \\
\instrusection{Orchestra Ensemble}
 \lvlo & \lstinline!'String Ensemble'! & \lvlo & \lstinline!'Voice Oohs'! \\
 \lvlt & \lstinline!'Orchestra Strings'! & \lvlt & \lstinline!'Humming'! \\
 \lvlt & \lstinline!'60s Strings'! & \lvlo & \lstinline!'Synth Voice'! \\
 \lvlo & \lstinline!'Slow String Ensemble'! & \lvlt & \lstinline!'Analog Voice'! \\
 \lvlo & \lstinline!'Synth Strings 1'! & \lvlo & \lstinline!'Orchestra Hit'! \\
 \lvlt & \lstinline!'Synth Strings 3'! & \lvlt & \lstinline!'Bass Hit'! \\
 \lvlo & \lstinline!'Synth Strings 2'! & \lvlt & \lstinline!'6th Hit'! \\
 \lvlo & \lstinline!'Choir Aahs'! & \lvlt & \lstinline!'Euro Hit'! \\
 \lvlt & \lstinline!'Choir Aahs 2'! \\
\instrusection{Brass}
 \lvlo & \lstinline!'Trumpet'! & \lvlo & \lstinline!'French Horns'! \\
 \lvlt & \lstinline!'Dark Trumpet'! & \lvlt & \lstinline!'French Horn 2'! \\
 \lvlo & \lstinline!'Trombone'! & \lvlo & \lstinline!'Brass Section 1'! \\
 \lvlt & \lstinline!'Trombone 2'! & \lvlt & \lstinline!'Brass Section 2'! \\
 \lvlt & \lstinline!'Bright Trombone'! & \lvlo & \lstinline!'Synth Brass 1'! \\
 \lvlo & \lstinline!'Tuba'! & \lvlt & \lstinline!'Synth Brass 3'! \\
 \lvlo & \lstinline!'Muted Trumpet'! & \lvlt & \lstinline!'Analog Brass 1'! \\
 \lvlt & \lstinline!'Muted Trumpet 2'! \\
\instrusection{Reed}
 \lvlt & \lstinline!'Jump Brass'! & \lvlo & \lstinline!'Tenor Sax'! \\
 \lvlo & \lstinline!'Synth Brass 2'! & \lvlo & \lstinline!'Baritone Sax'! \\
 \lvlt & \lstinline!'Synth Brass 4'! & \lvlo & \lstinline!'Oboe'! \\
 \lvlt & \lstinline!'Analog Brass 2'! & \lvlo & \lstinline!'English Horn'! \\
 \lvlo & \lstinline!'Soprano Sax'! & \lvlo & \lstinline!'Bassoon'! \\
 \lvlo & \lstinline!'Alto Sax'! & \lvlo & \lstinline!'Clarinet'! \\
\instrusection{Wind}
 \lvlo & \lstinline!'Piccolo'! & \lvlo & \lstinline!'Bottle Blow'! \\
 \lvlo & \lstinline!'Flute'! & \lvlo & \lstinline!'Shakuhachi'! \\
 \lvlo & \lstinline!'Recorder'! & \lvlo & \lstinline!'Whistle'! \\
 \lvlo & \lstinline!'Pan Flute'! & \lvlo & \lstinline!'Ocarina'! \\
\instrusection{Synth Lead}
 \lvlo & \lstinline!'Square Lead'! & \lvlo & \lstinline!'Synth Calliope'! \\
 \lvlt & \lstinline!'Square Wave'! & \lvlo & \lstinline!'Chiffer Lead'! \\
 \lvlt & \lstinline!'Sine Wave'! & \lvlo & \lstinline!'Charang'! \\
 \lvlo & \lstinline!'Saw Lead'! & \lvlt & \lstinline!'Wire Lead'! \\
 \lvlt & \lstinline!'Saw Wave'! & \lvlo & \lstinline!'Solo Synth Vox'! \\
 \lvlt & \lstinline!'Doctor Solo'! & \lvlo & \lstinline!'5th Saw Wave'! \\
 \lvlt & \lstinline!'Natural Lead'! & \lvlo & \lstinline!'Bass & Lead'! \\
 \lvlt & \lstinline!'Sequenced Saw'! & \lvlt & \lstinline!'Delayed Lead'! \\
\instrusection{Synth Pad}
 \lvlo & \lstinline!'Fantasia Pad'! & \lvlt & \lstinline!'Itopia'! \\
 \lvlo & \lstinline!'Warm Pad'! & \lvlo & \lstinline!'Bowed Glass Pad'! \\
 \lvlt & \lstinline!'Sine Pad'! & \lvlo & \lstinline!'Metal Pad'! \\
 \lvlo & \lstinline!'Polysynth Pad'! & \lvlo & \lstinline!'Halo Pad'! \\
 \lvlo & \lstinline!'Space Voice Pad'! & \lvlo & \lstinline!'Sweep Pad'! \\
\instrusection{Synth Sound FX}
 \lvlo & \lstinline!'Ice Rain'! & \lvlo & \lstinline!'Goblin'! \\
 \lvlo & \lstinline!'Soundtrack'! & \lvlo & \lstinline!'Echo Drops'! \\
 \lvlo & \lstinline!'Crystal'! & \lvlt & \lstinline!'Echo Bell'! \\
 \lvlt & \lstinline!'Synth Mallet'! & \lvlt & \lstinline!'Echo Pan'! \\
 \lvlo & \lstinline!'Atmosphere'! & \lvlo & \lstinline!'Star Theme'! \\
 \lvlo & \lstinline!'Brightness'! \\
\instrusection{Ethnic}
 \lvlo & \lstinline!'Sitar'! & \lvlt & \lstinline!'Taisho Koto'! \\
 \lvlt & \lstinline!'Sitar 2'! & \lvlo & \lstinline!'Kalimba'! \\
 \lvlo & \lstinline!'Banjo'! & \lvlo & \lstinline!'Bagpipe'! \\
 \lvlo & \lstinline!'Shamisen'! & \lvlo & \lstinline!'Fiddle'! \\
 \lvlo & \lstinline!'Koto'! & \lvlo & \lstinline!'Shanai'! \\
\instrusection{Percussive}
 \lvlo & \lstinline!'Tinkle Bell'! & \lvlo & \lstinline!'Melodic Tom 1'! \\
 \lvlo & \lstinline!'Agogo'! & \lvlt & \lstinline!'Melodic Tom 2'! \\
 \lvlo & \lstinline!'Steel Drums'! & \lvlo & \lstinline!'Synth Drum'! \\
 \lvlo & \lstinline!'Woodblock'! & \lvlt & \lstinline!'808 Tom'! \\
 \lvlt & \lstinline!'Castanets'! & \lvlt & \lstinline!'Electric Percussion'! \\
 \lvlo & \lstinline!'Taiko'! & \lvlo & \lstinline!'Reverse Cymbal'! \\
 \lvlt & \lstinline!'Concert Bass Drum'! \\
\instrusection{Sound Effect}
 \lvlo & \lstinline!'Guitar Fret Noise'! & \lvlo & \lstinline!'Helicopter'! \\
 \lvlt & \lstinline!'Guitar Cut Noise'! & \lvlt & \lstinline!'Car-Engine'! \\
 \lvlt & \lstinline!'String Slap'! & \lvlt & \lstinline!'Car-Stop'! \\
 \lvlo & \lstinline!'Breath Noise'! & \lvlt & \lstinline!'Car-Pass'! \\
 \lvlt & \lstinline!'Flute Key Click'! & \lvlt & \lstinline!'Car-Crash'! \\
 \lvlo & \lstinline!'Seashore'! & \lvlt & \lstinline!'Siren'! \\
 \lvlt & \lstinline!'Rain'! & \lvlt & \lstinline!'Train'! \\
 \lvlt & \lstinline!'Thunder'! & \lvlt & \lstinline!'Jetplane'! \\
 \lvlt & \lstinline!'Wind'! & \lvlt & \lstinline!'Starship'! \\
 \lvlt & \lstinline!'Stream'! & \lvlt & \lstinline!'Burst Noise'! \\
 \lvlt & \lstinline!'Bubble'! & \lvlo & \lstinline!'Applause'! \\
 \lvlo & \lstinline!'Bird'! & \lvlt & \lstinline!'Laughing'! \\
 \lvlt & \lstinline!'Dog'! & \lvlt & \lstinline!'Screaming'! \\
 \lvlt & \lstinline!'Horse-Gallop'! & \lvlt & \lstinline!'Punch'! \\
 \lvlt & \lstinline!'Bird 2'! & \lvlt & \lstinline!'Heart Beat'! \\
 \lvlo & \lstinline!'Telephone 1'! & \lvlt & \lstinline!'Footsteps'! \\
 \lvlt & \lstinline!'Telephone 2'! & \lvlo & \lstinline!'Gun Shot'! \\
 \lvlt & \lstinline!'Door Creaking'! & \lvlt & \lstinline!'Machine Gun'! \\
 \lvlt & \lstinline!'Door Closing'! & \lvlt & \lstinline!'Lasergun'! \\
 \lvlt & \lstinline!'Scratch'! & \lvlt & \lstinline!'Explosion'! \\
 \lvlt & \lstinline!'Wind Chimes'! \\
\end{longtable}
\end{center}

\subsection{Name of the available percussions}
\label{sec:AvailPercussion}

The names of the available percussions are listed here. A star (\lvlt) before a name means that instrument is only defined in the midi specification level 2. If the percussion is not defined by the midi player, it isn't played. The function \lstinline!cacofonix! can produce this list with:
\begin{lstlisting}
>> cacofonix -percussions % only level 1
>> cacofonix -percussions -level2 % levels 1 and 2
\end{lstlisting}

\begin{center}
\begin{longtable}{llll}
	& \multicolumn{1}{c}{Name (\lstinline!V-1!)} & \multicolumn{1}{c}{\lstinline!V-2!} & \multicolumn{1}{c}{\lstinline!V-3!} \\
\endfirsthead
	& \multicolumn{1}{c}{Name (\lstinline!V-1!)} & \multicolumn{1}{c}{\lstinline!V-2!} & \multicolumn{1}{c}{\lstinline!V-3!} \\
\endhead
 \lvlt & \lstinline!'High Q'! & & \\
 \lvlt & \lstinline!'Slap'! & & \\
 \lvlt & \lstinline!'Scratch'! & & \\
 \lvlt & \lstinline!'Scratch 2'! & & \\
 \lvlt & \lstinline!'Sticks'! & & \\
 \lvlt & \lstinline!'Square'! & & \\
 \lvlt & \lstinline!'Metronome'! & & \\
 \lvlt & \lstinline!'Metronome 2'! & & \\
 \lvlo & \lstinline!'Acoustic Bass Drum'! & & \\
 \lvlo & \lstinline!'Bass Drum 1'! & & \\
 \lvlo & \lstinline!'Side Stick'! & & \\
 \lvlo & \lstinline!'Acoustic Snare'! & & \\
 \lvlo & \lstinline!'Hand Clap'! & & \\
 \lvlo & \lstinline!'Electric Snare'! & & \\
 \lvlo & \lstinline!'Low Floor Tom'! & & \\
 \lvlo & \lstinline!'Closed Hi-Hat'! & \lstinline!'Open Hi-Hat'! & \lstinline!'Pedal Hi-Hat'! \\
 \lvlo & \lstinline!'High Floor Tom'! & & \\
 \lvlo & \lstinline!'Pedal Hi-Hat'! & \lstinline!'Open Hi-Hat'! & \lstinline!'Closed Hi-Hat'! \\
 \lvlo & \lstinline!'Low Tom'! & & \\
 \lvlo & \lstinline!'Open Hi-Hat'! & \lstinline!'Pedal Hi-Hat'! & \lstinline!'Closed Hi-Hat'! \\
 \lvlo & \lstinline!'Low-Mid Tom'! & & \\
 \lvlo & \lstinline!'Hi-Mid Tom'! & & \\
 \lvlo & \lstinline!'Crash Cymbal 1'! & & \\
 \lvlo & \lstinline!'High Tom'! & & \\
 \lvlo & \lstinline!'Ride Cymbal 1'! & & \\
 \lvlo & \lstinline!'Chinese Cymbal'! & & \\
 \lvlo & \lstinline!'Ride Bell'! & & \\
 \lvlo & \lstinline!'Tambourine'! & & \\
 \lvlo & \lstinline!'Splash Cymbal'! & & \\
 \lvlo & \lstinline!'Cowbell'! & & \\
 \lvlo & \lstinline!'Crash Cymbal 2'! & & \\
 \lvlo & \lstinline!'Vibraslap'! & & \\
 \lvlo & \lstinline!'Ride Cymbal 2'! & & \\
 \lvlo & \lstinline!'Hi Bongo'! & & \\
 \lvlo & \lstinline!'Low Bongo'! & & \\
 \lvlo & \lstinline!'Mute Hi Conga'! & & \\
 \lvlo & \lstinline!'Open Hi Conga'! & & \\
 \lvlo & \lstinline!'Low Conga'! & & \\
 \lvlo & \lstinline!'High Timbale'! & & \\
 \lvlo & \lstinline!'Low Timbale'! & & \\
 \lvlo & \lstinline!'High Agogo'! & & \\
 \lvlo & \lstinline!'Low Agogo'! & & \\
 \lvlo & \lstinline!'Cabasa'! & & \\
 \lvlo & \lstinline!'Maracas'! & & \\
 \lvlo & \lstinline!'Short Whistle'! & \lstinline!'Long Whistle'! & \\
 \lvlo & \lstinline!'Long Whistle'! & \lstinline!'Short Whistle'! & \\
 \lvlo & \lstinline!'Short Guiro'! & \lstinline!'Long Guiro'! & \\
 \lvlo & \lstinline!'Long Guiro'! & \lstinline!'Short Guiro'! & \\
 \lvlo & \lstinline!'Claves'! & & \\
 \lvlo & \lstinline!'Hi Wood Block'! & & \\
 \lvlo & \lstinline!'Low Wood Block'! & & \\
 \lvlo & \lstinline!'Mute Cuica'! & \lstinline!'Open Cuica'! & \\
 \lvlo & \lstinline!'Open Cuica'! & \lstinline!'Mute Cuica'! & \\
 \lvlo & \lstinline!'Mute Triangle'! & \lstinline!'Open Triangle'! & \\
 \lvlo & \lstinline!'Open Triangle'! & \lstinline!'Mute Triangle'! & \\
 \lvlt & \lstinline!'Shaker'! & & \\
 \lvlt & \lstinline!'Jingle Bell'! & & \\
 \lvlt & \lstinline!'Belltree'! & & \\
 \lvlt & \lstinline!'Castanets'! & & \\
 \lvlt & \lstinline!'Mute Surdo'! & \lstinline!'Open Surdo'! & \\
 \lvlt & \lstinline!'Open Surdo'! & \lstinline!'Mute Surdo'! & \\
\end{longtable}
\end{center}

\subsection{Name of the available drum kits}
\label{sec:AvailDrumKits}

The names of the available drum kits are listed here. Only the first kit is fixed by the midi specification level 1. If the drum kit is not defined by the midi player, the standard kit is used. When a drum kit is used, the name of percussions can be completely wrong. The function \lstinline!cacofonix! can produce this list with:
\begin{lstlisting}
>> cacofonix -drumkits
\end{lstlisting}

\begin{center}
\begin{longtable}{ll}
\multicolumn{1}{c}{Name} & \multicolumn{1}{c}{Description} \\
\endfirsthead
\multicolumn{1}{c}{Name} & \multicolumn{1}{c}{Description} \\
\endhead
\lstinline!'Standard'! & the only kit specified by General MIDI Level 1 \\
\lstinline!'Room'! & more ambient percussive sounds \\
\lstinline!'Power'! & more powerful kick and snare sounds \\
\lstinline!'Electronic'! & emulations of various electronic drum machines \\
\lstinline!'TR-808'! & analog drum kit similar to Roland TR-808 \\
\lstinline!'Jazz'! & nearly identical to the Standard kit \\
\lstinline!'Brush'! & many brush sounds added \\
\lstinline!'Orchestra'! & a collection of concert drums and timpani \\
\lstinline!'Sound FX'! & a collection of sound effects \\
\lstinline!'CM-64/CM-32L'! & the standard MT-32 Drum Kit \\
\end{longtable}
\end{center}

\end{document}
